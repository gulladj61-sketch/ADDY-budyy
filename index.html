<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Addy AI Studio ‚Äî All-in-one (Proxy Ready)</title>
<style>
  /* Minimal premium dark glass UI - compact for single file */
  :root{
    --bg:#07111a; --panel:#0f1724; --accent:#5ef2c6; --muted:#9aa4b2;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#02111a,#07111a);color:#e6eef6}
  .wrap{max-width:1100px;margin:20px auto;padding:18px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7ec8ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:#08111a}
  h1{font-size:20px;margin:0}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
  /* Chat area */
  .chat-panel{display:flex;flex-direction:column;height:76vh;gap:12px}
  .messages{flex:1;overflow:auto;padding:12px;border-radius:8px;background:rgba(0,0,0,0.12)}
  .msg{margin-bottom:12px;max-width:84%}
  .msg .who{font-size:12px;color:var(--muted);margin-bottom:6px}
  .msg.user{align-self:flex-end;text-align:right}
  .bubble{display:inline-block;padding:12px;border-radius:12px;background:linear-gradient(90deg,#04a99f,#00f0c5);color:#02111a}
  .bubble.bot{background:linear-gradient(90deg,#0d1620,#12212a);color:#e6eef6;border:1px solid rgba(255,255,255,0.02)}
  .controls{display:flex;gap:8px;align-items:center}
  input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
  button.primary{background:linear-gradient(90deg,var(--accent),#7ec8ff);border:none;padding:8px 14px;border-radius:10px;color:#02111a;font-weight:700}
  /* Tools list */
  .tools{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .tool{padding:10px;border-radius:999px;border:1px solid rgba(255,255,255,0.03);background:transparent;text-align:center;cursor:pointer}
  .small{font-size:13px;color:var(--muted)}
  footer{margin-top:14px;color:var(--muted);font-size:13px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">MB</div>
      <div>
        <h1>Addy ‚Äî AI Studio</h1>
        <div class="small">Offline demo UI ‚Äî proxy ready (use Render proxy for real AI)</div>
      </div>
    </div>
    <div class="small">Addy ‚Ä¢ v2.0</div>
  </header>

  <div class="grid">
    <!-- left chat + tools -->
    <div class="card">
      <div class="chat-panel">
        <div class="messages" id="messages"></div>

        <div class="controls">
          <input id="inputText" placeholder="Type a message or press mic..." />
          <button class="primary" id="sendBtn">Send</button>
          <button id="micBtn" title="Voice" class="tool">üé§</button>
        </div>

        <div style="margin-top:10px">
          <div class="small">Tools ‚Äî click to run (uses proxy)</div>
          <div class="tools" id="tools">
            <!-- Tools will be injected -->
          </div>
        </div>
      </div>
    </div>

    <!-- right panel -->
    <div class="card">
      <div style="margin-bottom:8px">
        <strong>Proxy / Service</strong>
        <div class="small">Set `PROXY_BASE` variable at top of this file to your Render proxy URL</div>
      </div>

      <div style="margin-bottom:10px">
        <label class="small">Proxy base URL</label>
        <input id="proxyInput" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit" />
        <div class="small" style="margin-top:6px">Example: https://addy-proxy.onrender.com</div>
        <button id="saveProxy" class="primary" style="margin-top:8px">Save Proxy</button>
      </div>

      <div style="margin-top:10px">
        <strong>Status</strong>
        <div id="status" class="small">Proxy not set</div>
      </div>

      <div style="margin-top:12px">
        <strong>Quick actions</strong>
        <div class="row" style="margin-top:8px">
          <button id="testProxy" class="tool">Test Proxy</button>
          <button id="clearChat" class="tool">Clear Chat</button>
        </div>
      </div>
    </div>
  </div>

  <footer>Note: For real LLM & ElevenLabs voice ‚Äî deploy proxy and set OPENAI_KEY & ELEVEN_KEY on server. Frontend uses proxy endpoints: <code>/api/openai</code> and <code>/api/voice</code>.</footer>
</div>

<script>
/*
  Single-file frontend.
  IMPORTANT: Set PROXY_BASE in localStorage via UI after pasting file.
  Proxy endpoints used:
    POST {PROXY_BASE}/api/openai    -> expects body (OpenAI chat completion or image request)
    POST {PROXY_BASE}/api/voice     -> expects body for TTS (ElevenLabs)
*/
(function(){
  // default (if you want to prefill while testing, replace with your proxy):
  let PROXY_BASE = ""; // <-- leave empty here, use UI to set

  // Tools list (you can add/remove labels & payload functions)
  const TOOLS = [
    {id:'ai_writer', label:'AI Writer', prompt:'Write a short blog intro about {{input}}.'},
    {id:'code_helper', label:'Code Helper', prompt:'Explain how to implement {{input}} with example code.'},
    {id:'prompt_maker', label:'Prompt Maker', prompt:'Create a strong prompt for: {{input}}.'},
    {id:'translator', label:'Translator', prompt:'Translate to Hindi: {{input}}.'},
    {id:'summarizer', label:'Summarizer', prompt:'Summarize: {{input}}.'},
    {id:'seo_title', label:'SEO Title Maker', prompt:'Create SEO title for: {{input}}.'},
    {id:'business_ideas', label:'Business Ideas', prompt:'Give 10 startup ideas for: {{input}}.'},
    {id:'img_prompt', label:'Image Prompt', prompt:'Generate an image prompt for: {{input}}.'},
    {id:'story_maker', label:'Story Maker', prompt:'Write a short story about: {{input}}.'},
    {id:'study_helper', label:'Study Helper', prompt:'Explain concept: {{input}} in simple words.'},
    {id:'email_writer', label:'Email Writer', prompt:'Write a professional email for: {{input}}.'},
    {id:'ad_copy', label:'Ad Copy', prompt:'Write ad copy for: {{input}}.'},
    {id:'translator_brief', label:'Translator (brief)', prompt:'Translate briefly to Spanish: {{input}}.'},
    {id:'idea_expand', label:'Idea Expand', prompt:'Expand this idea: {{input}}.'},
    {id:'qa', label:'Q/A', prompt:'Answer the question: {{input}}.'},
    {id:'image_analyze', label:'Image Analyze', prompt:'Analyze image (not supported in demo).'},
    {id:'summarize_url', label:'Summarize URL', prompt:'Summarize the content of URL: {{input}}.'},
    {id:'seo_meta', label:'SEO Meta', prompt:'Generate meta description for: {{input}}.'},
    {id:'tweet', label:'Tweet', prompt:'Write a tweet about: {{input}}.'},
    {id:'brainstorm', label:'Brainstorm', prompt:'Brainstorm ideas for: {{input}}.'}
  ];

  // DOM
  const messages = document.getElementById('messages');
  const inputText = document.getElementById('inputText');
  const sendBtn = document.getElementById('sendBtn');
  const micBtn = document.getElementById('micBtn');
  const toolsDiv = document.getElementById('tools');
  const proxyInput = document.getElementById('proxyInput');
  const saveProxy = document.getElementById('saveProxy');
  const status = document.getElementById('status');
  const testProxy = document.getElementById('testProxy');
  const clearChat = document.getElementById('clearChat');

  // load saved proxy
  function loadProxy(){
    const saved = localStorage.getItem('PROXY_BASE');
    if(saved){ PROXY_BASE = saved; proxyInput.value = saved; status.innerText = 'Proxy: ' + saved; }
    else status.innerText = 'Proxy not set';
  }
  loadProxy();

  // attach tools
  TOOLS.forEach(t=>{
    const el = document.createElement('div');
    el.className='tool';
    el.innerText = t.label;
    el.onclick = ()=>askTool(t);
    toolsDiv.appendChild(el);
  });

  // utility to add message
  function addMsg(text, who='bot'){
    const wrap = document.createElement('div'); wrap.className='msg ' + (who==='user'?'user':'bot');
    const w = document.createElement('div'); w.className='who'; w.innerText = who==='user'?'You':'Addy';
    const b = document.createElement('div'); b.className='bubble ' + (who==='user'?'':'bot'); b.innerText = text;
    wrap.appendChild(w); wrap.appendChild(b); messages.appendChild(wrap); messages.scrollTop = messages.scrollHeight;
  }

  // send chat
  sendBtn.onclick = async ()=>{
    const txt = inputText.value.trim(); if(!txt) return;
    addMsg(txt,'user'); inputText.value='';
    addMsg('Listening...','bot');
    await callOpenAI({role:'user', content:txt});
  };

  // start/stop mic (Web Speech API)
  let recog, listening=false;
  if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recog = new SpeechRecognition();
    recog.lang = 'en-US';
    recog.continuous = false;
    recog.onresult = (e)=>{ const text = e.results[0][0].transcript; inputText.value = text; addMsg(text,'user'); callOpenAI({role:'user', content:text}); };
    recog.onerror = ()=>{ addMsg('Voice error','bot') };
  } else {
    micBtn.style.display='none';
  }
  micBtn.onclick = ()=>{ if(!recog) return; if(!listening){recog.start(); listening=true; micBtn.innerText='‚èπ';} else {recog.stop(); listening=false; micBtn.innerText='üé§'} };

  // tool trigger
  async function askTool(tool){
    const userInput = prompt('Enter input for: ' + tool.label);
    if(userInput===null) return;
    addMsg(userInput,'user');
    const promptText = (tool.prompt || '').replace('{{input}}', userInput);
    addMsg('Running ' + tool.label + '...','bot');
    await callOpenAI({role:'user', content: promptText, meta:{tool:tool.id}});
  }

  // openai call via proxy
  async function callOpenAI(body){
    try{
      if(!PROXY_BASE){ addMsg('Proxy not set. Set proxy URL on the right panel.','bot'); return; }
      // normalise body: our proxy expects the OpenAI chat shape or a {prompt,mode} wrapper
      let payload = {};
      if(body.meta && body.meta.tool){
        // quick: wrap tool prompt into chat completion
        payload = {
          model: "gpt-4o-mini", // demo label; proxy should map to an available model
          messages: [{role:'user',content:body.content}],
          max_tokens: 700
        };
      } else if(body.role){
        payload = {
          model: "gpt-4o-mini",
          messages: [body],
          max_tokens: 700
        };
      } else {
        payload = body;
      }

      const res = await fetch(PROXY_BASE + '/api/openai', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if(!res.ok){
        const t = await res.text(); addMsg('Proxy error: ' + res.status + ' - ' + t,'bot'); return;
      }
      const data = await res.json();
      // adapt to either direct text or ChatCompletion shape
      let text = '';
      if(data.choices && data.choices[0] && data.choices[0].message) text = data.choices[0].message.content;
      else if(data.output && data.output[0]) text = data.output[0].content || JSON.stringify(data);
      else if(typeof data === 'string') text = data;
      else text = (data.result || data.text || JSON.stringify(data)).toString();

      // show result
      addMsg(text,'bot');

      // If response has tts request (auto), call voice
      // For demonstration, we add a 'Speak' button per response (optional)
      const speakBtn = document.createElement('button'); speakBtn.className='tool'; speakBtn.innerText='üîä Speak';
      speakBtn.onclick = ()=>callVoice({text});
      const container = document.createElement('div'); container.style.marginTop='6px'; container.appendChild(speakBtn);
      messages.appendChild(container); messages.scrollTop = messages.scrollHeight;

    } catch(err){
      addMsg('Error: ' + err.message,'bot');
    }
  }

  // TTS via proxy
  async function callVoice({text}){
    try{
      if(!PROXY_BASE){ addMsg('Proxy not set','bot'); return; }
      const res = await fetch(PROXY_BASE + '/api/voice', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({text})
      });
      if(!res.ok){ const t=await res.text(); addMsg('Voice proxy error: '+t,'bot'); return; }
      // Expecting audio/ogg or base64 JSON. Try to handle both.
      const contentType = res.headers.get('content-type') || '';
      if(contentType.includes('audio')){
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = new Audio(url); a.play();
      } else {
        const json = await res.json();
        // if response contains {audioBase64: "..."} or url
        if(json.audioBase64){
          const b = atob(json.audioBase64.split(',').pop());
          let len = b.length; const u8 = new Uint8Array(len);
          while(len--) u8[len]=b.charCodeAt(len);
          const blob = new Blob([u8], {type:'audio/mpeg'});
          const url = URL.createObjectURL(blob);
          new Audio(url).play();
        } else if(json.url){
          new Audio(json.url).play();
        } else addMsg('Voice response unknown format','bot');
      }
    } catch(err){
      addMsg('Voice error: '+err.message,'bot');
    }
  }

  // quick proxy test
  testProxy.onclick = async ()=>{
    if(!PROXY_BASE){ addMsg('Proxy not set','bot'); return; }
    addMsg('Testing proxy...','bot');
    try{
      const r = await fetch(PROXY_BASE + '/');
      addMsg('Proxy responded: ' + r.status + ' ‚Äî ' + await r.text(),'bot');
    }catch(e){ addMsg('Proxy test failed: '+e.message,'bot'); }
  };

  // save proxy
  saveProxy.onclick = ()=>{
    const v = proxyInput.value.trim();
    if(!v){ alert('Enter proxy URL'); return; }
    PROXY_BASE = v.replace(/\/+$/,''); // trim trailing slash
    localStorage.setItem('PROXY_BASE', PROXY_BASE);
    status.innerText = 'Proxy: ' + PROXY_BASE;
    addMsg('Proxy saved: ' + PROXY_BASE,'bot');
  };

  clearChat.onclick = ()=>{ messages.innerHTML=''; addMsg('Chat cleared','bot'); };

  // initial welcome
  addMsg("Hi ‚Äî I'm Addy. Set your proxy on the right and click any tool to try. For full features, make sure your proxy supports /api/openai and /api/voice.","bot");

  // keyboard enter
  inputText.addEventListener('keydown', (e)=>{ if(e.key==='Enter') sendBtn.click(); });

})();
</script>
</body>
</html>
