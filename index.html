<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ADDY ‚Äî Super Free AI Hub (Part-1)</title>
  <meta name="description" content="ADDY Part-1: Photo Editor, Voice Reader, Text Tools, Drawing Canvas. Client-side, no API keys.">
  <style>
    :root{
      --bg:#041021; --card:#072033; --accent:#00d4ff; --accent2:#4ce6a1; --muted:#9fb7d8;
      --glass: rgba(255,255,255,0.03);
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#03111b 0%, #02101a 100%);color:#e6f7ff;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--accent)}
    .wrap{max-width:var(--maxw);margin:14px auto;padding:12px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    header h1{margin:0;font-size:20px;color:var(--accent)}
    header .sub{color:var(--muted);font-size:13px}
    nav.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    nav .tab{padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.02);cursor:pointer;color:var(--muted)}
    nav .tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#012827;font-weight:700}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);margin-top:12px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:14px;margin-top:12px}
    @media(max-width:980px){.grid{grid-template-columns:1fr} .side{order:2}}
    .small{font-size:13px;color:var(--muted)}
    label{font-size:13px;color:#cfe9ff;margin-bottom:6px;display:block}
    input,select,button,textarea{font-family:inherit}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:var(--accent);border:none;color:#022429;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .btn.alt{background:#183043;color:#fff}
    canvas{display:block;max-width:100%;border-radius:8px;background:#000;margin-top:10px;border:1px solid rgba(255,255,255,0.03)}
    textarea{width:100%;min-height:90px;border-radius:8px;background:transparent;color:#eaf7ff;border:1px solid rgba(255,255,255,0.04);padding:8px}
    .muted{color:var(--muted);font-size:13px}
    .hint{font-size:12px;color:var(--muted)}
    footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
    .control{margin-top:8px}
    .flex{display:flex;gap:8px;align-items:center}
    .col{display:flex;flex-direction:column;gap:8px}
    .kbd{background:var(--glass);padding:5px 8px;border-radius:6px;color:var(--muted);font-size:13px}
    .progress{height:8px;background:rgba(255,255,255,0.03);border-radius:6px;overflow:hidden;margin-top:6px}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,#00d4ff,#4ce6a1);width:0%}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#00d4ff,#4ce6a1);display:flex;align-items:center;justify-content:center;font-weight:800;color:#012827}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex;gap:12px;align-items:center;">
        <div class="logo">AD</div>
        <div>
          <h1>ADDY ‚Äî Super Free AI Hub (Part-1)</h1>
          <div class="sub">Photo Editor ‚Ä¢ Voice Reader ‚Ä¢ Text Tools ‚Ä¢ Drawing Canvas ‚Äî No API keys</div>
        </div>
      </div>
      <div class="muted">Use Chrome on mobile for best compatibility</div>
    </header>

    <nav class="tabs" id="tabs">
      <div class="tab active" data-tab="editor">Image Editor</div>
      <div class="tab" data-tab="voice">Voice Reader</div>
      <div class="tab" data-tab="text">Text Tools</div>
      <div class="tab" data-tab="draw">Drawing</div>
      <div class="tab" data-tab="help">Help</div>
    </nav>

    <div id="content">
      <!-- EDITOR -->
      <div class="card" id="editor" style="display:block">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">üñºÔ∏è Photo Editor</h2>
            <div class="small">Upload, filter, crop, auto-enhance, download ‚Äî client-side only.</div>
          </div>
          <div class="hint">Tip: Use fit & auto-enhance for better OCR later</div>
        </div>
        <hr/>
        <div class="row">
          <div style="flex:1">
            <label>Upload image</label>
            <input id="fileEditor" type="file" accept="image/*">
            <div class="control row" style="margin-top:8px">
              <button id="fitCanvas" class="btn alt">Fit</button>
              <button id="resetImg" class="btn alt">Reset</button>
              <button id="downloadImg" class="btn">Download PNG</button>
            </div>
          </div>
          <div style="width:320px">
            <label>Quick Presets</label>
            <div class="row">
              <button class="btn" id="preset-natural">Natural</button>
              <button class="btn alt" id="preset-vivid">Vivid</button>
              <button class="btn" id="preset-bw">B/W</button>
            </div>
            <div class="hint" style="margin-top:8px">Use presets to quickly test looks.</div>
          </div>
        </div>

        <canvas id="editorCanvas"></canvas>

        <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:10px">
          <div style="min-width:160px">
            <label>Brightness</label>
            <input id="ed-bright" type="range" min="0" max="200" value="100">
          </div>
          <div style="min-width:160px">
            <label>Contrast</label>
            <input id="ed-contrast" type="range" min="0" max="200" value="100">
          </div>
          <div style="min-width:140px">
            <label>Saturate</label>
            <input id="ed-sat" type="range" min="0" max="200" value="100">
          </div>
          <div style="min-width:140px">
            <label>Blur</label>
            <input id="ed-blur" type="range" min="0" max="12" value="0">
          </div>
          <div style="min-width:120px">
            <label>Hue</label>
            <input id="ed-hue" type="range" min="0" max="360" value="0">
          </div>
          <div style="min-width:120px">
            <label>Tint</label>
            <input id="ed-tint" type="color" value="#ffffff">
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
          <button id="applyEd" class="btn">Apply Filters</button>
          <button id="autoEnhanceBtn" class="btn alt">Auto Enhance</button>
          <button id="cropBtn" class="btn alt">Crop</button>
          <div style="flex:1"></div>
          <div class="muted">Current image: <span id="imgInfo">none</span></div>
        </div>
      </div>

      <!-- VOICE -->
      <div class="card" id="voice" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">üîä Voice Reader (Text ‚Üí Speech)</h2>
            <div class="small">Use browser speechSynthesis to read text aloud. Works offline.</div>
          </div>
          <div class="hint">Choose language/voice and press Read</div>
        </div>
        <hr/>
        <label>Paste text to read</label>
        <textarea id="voiceText" placeholder="Type or paste text..."></textarea>

        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <label style="display:flex;align-items:center;gap:8px">Voice<select id="voiceSelect"></select></label>
          <label style="display:flex;align-items:center;gap:8px">Rate <input id="rate" type="range" min="0.5" max="2" step="0.1" value="1"></label>
          <label style="display:flex;align-items:center;gap:8px">Pitch <input id="pitch" type="range" min="0.5" max="2" step="0.1" value="1"></label>
          <button id="readBtn" class="btn">Read</button>
          <button id="stopRead" class="btn alt">Stop</button>
        </div>

        <div class="hint" style="margin-top:8px">Tip: Use short paragraphs for best results on mobile.</div>
      </div>

      <!-- TEXT -->
      <div class="card" id="text" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">‚úÇÔ∏è Text Tools</h2>
            <div class="small">Summarize, Paraphrase, Copy, Auto-save.</div>
          </div>
          <div class="hint">Autosaves to localStorage</div>
        </div>
        <hr/>
        <label>Input / Paste article</label>
        <textarea id="textInput" placeholder="Paste long text here..."></textarea>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="summBtn" class="btn">Summarize (3 sentences)</button>
          <button id="paraBtn" class="btn alt">Paraphrase (simple)</button>
          <button id="copyText" class="btn">Copy Output</button>
          <button id="clearText" class="btn alt">Clear</button>
        </div>

        <label style="margin-top:8px">Output</label>
        <textarea id="textOutput" placeholder="Output will appear here..."></textarea>
        <div class="hint" style="margin-top:6px">Press Summarize to get extractive summary (client-side)</div>
      </div>

      <!-- DRAW -->
      <div class="card" id="draw" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">üé® Drawing Canvas</h2>
            <div class="small">Draw, stickers, export PNG ‚Äî client-only.</div>
          </div>
          <div class="hint">Use finger (mobile) to draw</div>
        </div>
        <hr/>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <label>Canvas Size <select id="drawSize"><option value="800">800x600</option><option value="600">600x450</option><option value="400">400x300</option></select></label>
          <label>Brush <input id="brushSize" type="range" min="1" max="60" value="6"></label>
          <label>Color <input id="brushColor" type="color" value="#ffffff"></label>
          <button id="clearCanvas" class="btn alt">Clear</button>
          <button id="undoBtn" class="btn alt">Undo</button>
          <button id="saveDraw" class="btn">Export PNG</button>
        </div>
        <canvas id="drawCanvas" style="margin-top:10px;border:1px solid rgba(255,255,255,0.04);border-radius:8px"></canvas>
        <div class="hint" style="margin-top:8px">You can drag images onto the canvas (desktop) or use sticker paste.</div>
      </div>

      <!-- HELP -->
      <div class="card" id="help" style="display:none">
        <h2 style="margin:0">‚ÑπÔ∏è Help & Next Steps</h2>
        <hr/>
        <div class="small">
          <ul>
            <li>Part-1 provides client-side tools only ‚Äî no API keys.</li>
            <li>Part-2 will add: BodyPix background remove, OCR export improvements, embed list of free HF spaces.</li>
            <li>Part-3 will add: QR, GrabCut, style transfer hooks, session manager & deploy pack generator.</li>
            <li>To make this production-ready (monetize), later we'll add serverless proxies and user auth (optional).</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="card">
        <h3 style="margin:0">Quick Actions</h3>
        <hr/>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="clearAllBtn" class="btn alt">Clear All</button>
          <button id="exportSession" class="btn">Export Session</button>
          <button id="importSession" class="btn alt">Import Session</button>
          <input type="file" id="importFile" accept=".json" style="display:none">
        </div>
        <label style="margin-top:10px">Session Notes</label>
        <textarea id="sessionNotes" placeholder="Notes..."></textarea>
      </div>

      <aside class="side card">
        <h3 style="margin:0">Tips</h3>
        <hr/>
        <div class="small">
          ‚Ä¢ Use Fit before removing background in future parts.<br>
          ‚Ä¢ Use Auto-enhance for OCR clarity.<br>
          ‚Ä¢ Save sessions to continue later.<br>
          ‚Ä¢ For voice, choose appropriate voice in dropdown.<br>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="nextPart" class="btn">Request Part-2</button>
          <button id="askDeploy" class="btn alt">Make GitHub Pack</button>
        </div>
      </aside>
    </div>

    <footer>Made with ‚ù§Ô∏è ‚Äî ADDY Part-1 ‚Äî paste into index.html and commit. Reply "next" to get Part-2.</footer>
  </div>

<script>
/* -----------------------
   ADDY Part-1 JS
   - Editor, Voice Reader, Text Tools, Drawing canvas
   - Client-side only; no external API keys
   ----------------------- */

/* Utilities */
const $ = id => document.getElementById(id);
const qs = s => document.querySelector(s);
function showTab(name){
  ['editor','voice','text','draw','help'].forEach(t=>{
    const el = $(t); if(el) el.style.display = (t===name? 'block':'none');
    // tabs
    document.querySelectorAll('#tabs .tab').forEach(tab=>{
      tab.classList.toggle('active', tab.dataset.tab===name);
    });
  });
}

/* Tab nav */
document.querySelectorAll('#tabs .tab').forEach(tab=>{
  tab.addEventListener('click', ()=> showTab(tab.dataset.tab));
});

/* ------------------ Photo Editor ------------------ */
const fileEditor = $('fileEditor'), editorCanvas = $('editorCanvas'), ectx = editorCanvas.getContext('2d');
let edImg = new Image(), edOriginal = null, edCurrentData = null;

function fitEditorCanvas(maxW=900){
  const w = Math.min(window.innerWidth-40, maxW);
  if(!edImg.src) return;
  const ratio = edImg.naturalHeight / edImg.naturalWidth;
  editorCanvas.width = w;
  editorCanvas.height = Math.round(w * ratio);
  drawEditor();
}

fileEditor.addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ev=>{
    edImg = new Image();
    edImg.onload = ()=> { edOriginal = ev.target.result; fitEditorCanvas(); $('imgInfo').innerText = edImg.naturalWidth + 'x' + edImg.naturalHeight; };
    edImg.src = ev.target.result;
  };
  reader.readAsDataURL(f);
});

window.addEventListener('resize', ()=> fitEditorCanvas());

function drawEditor(){
  if(!edImg.src) return;
  ectx.clearRect(0,0,editorCanvas.width,editorCanvas.height);
  const b = $('ed-bright').value, c = $('ed-contrast').value, s = $('ed-sat').value, bl = $('ed-blur').value, hue = $('ed-hue').value;
  const filter = `brightness(${b}%) contrast(${c}%) saturate(${s}%) blur(${bl}px) hue-rotate(${hue}deg)`;
  ectx.filter = filter;
  ectx.drawImage(edImg, 0,0, editorCanvas.width, editorCanvas.height);
  ectx.filter = 'none';
  const tint = $('ed-tint').value;
  if(tint && tint !== '#ffffff'){
    ectx.fillStyle = tint + '33';
    ectx.fillRect(0,0,editorCanvas.width,editorCanvas.height);
  }
  try{ edCurrentData = editorCanvas.toDataURL('image/png'); }catch(e){ console.log('ed toDataURL failed', e); }
}

['ed-bright','ed-contrast','ed-sat','ed-blur','ed-hue'].forEach(id=> $(id).addEventListener('input', drawEditor));
$('ed-tint').addEventListener('input', drawEditor);

$('fitCanvas').addEventListener('click', ()=> fitEditorCanvas());
$('resetImg').addEventListener('click', ()=> { if(edOriginal){ edImg.src = edOriginal; fitEditorCanvas(); }});
$('downloadImg').addEventListener('click', ()=> {
  if(!edCurrentData && edOriginal) { edImg.src = edOriginal; fitEditorCanvas(); }
  if(!edCurrentData) return alert('Upload image first');
  const a = document.createElement('a'); a.href = edCurrentData; a.download = 'addy_edit.png'; a.click();
});

/* presets */
$('preset-natural').addEventListener('click', ()=>{
  $('ed-bright').value=100; $('ed-contrast').value=100; $('ed-sat').value=100; $('ed-blur').value=0; $('ed-hue').value=0; $('ed-tint').value='#ffffff'; drawEditor();
});
$('preset-vivid').addEventListener('click', ()=>{
  $('ed-bright').value=110; $('ed-contrast').value=120; $('ed-sat').value=140; $('ed-blur').value=0; $('ed-hue').value=0; $('ed-tint').value='#ffffff'; drawEditor();
});
$('preset-bw').addEventListener('click', ()=>{ $('ed-sat').value=0; $('ed-contrast').value=110; $('ed-bright').value=95; $('ed-tint').value='#ffffff'; drawEditor();});

/* auto-enhance */
$('autoEnhanceBtn').addEventListener('click', ()=>{
  if(!edImg.src) return alert('Upload an image first');
  // simple histogram stretch on a temp canvas
  const tmp = document.createElement('canvas'); tmp.width = edImg.naturalWidth; tmp.height = edImg.naturalHeight;
  const tctx = tmp.getContext('2d'); tctx.drawImage(edImg,0,0);
  const imgd = tctx.getImageData(0,0,tmp.width,tmp.height);
  let rmin=255,gmin=255,bmin=255, rmax=0,gmax=0,bmax=0;
  for(let i=0;i<imgd.data.length;i+=4){
    const r=imgd.data[i], g=imgd.data[i+1], b=imgd.data[i+2];
    if(r<rmin) rmin=r; if(g<gmin) gmin=g; if(b<bmin) bmin=b;
    if(r>rmax) rmax=r; if(g>gmax) gmax=g; if(b>bmax) bmax=b;
  }
  for(let i=0;i<imgd.data.length;i+=4){
    imgd.data[i] = Math.round((imgd.data[i]-rmin)/(rmax-rmin||1)*255);
    imgd.data[i+1] = Math.round((imgd.data[i+1]-gmin)/(gmax-gmin||1)*255);
    imgd.data[i+2] = Math.round((imgd.data[i+2]-bmin)/(bmax-bmin||1)*255);
  }
  tctx.putImageData(imgd,0,0);
  edImg.src = tmp.toDataURL();
  edOriginal = edImg.src;
  fitEditorCanvas();
});

/* crop - simple center crop to square example */
$('cropBtn').addEventListener('click', ()=>{
  if(!edImg.src) return alert('Upload an image first');
  const tmp = document.createElement('canvas'); const min = Math.min(edImg.naturalWidth, edImg.naturalHeight);
  tmp.width = min; tmp.height = min;
  const tctx = tmp.getContext('2d');
  tctx.drawImage(edImg, (edImg.naturalWidth-min)/2, (edImg.naturalHeight-min)/2, min, min, 0,0,min,min);
  edImg.src = tmp.toDataURL();
  edOriginal = edImg.src;
  fitEditorCanvas();
});

/* ------------------ Voice Reader ------------------ */
const synth = window.speechSynthesis;
let voices = [];
function populateVoices(){
  voices = synth.getVoices();
  const sel = $('voiceSelect'); sel.innerHTML = '';
  voices.forEach(v=>{
    const opt = document.createElement('option'); opt.value = v.name; opt.textContent = `${v.name} (${v.lang})`;
    sel.appendChild(opt);
  });
}
if(synth.onvoiceschanged !== undefined) synth.onvoiceschanged = populateVoices;
populateVoices();

$('readBtn').addEventListener('click', ()=>{
  const text = $('voiceText').value || '';
  if(!text) return alert('Type some text first');
  if(synth.speaking) { synth.cancel(); }
  const ut = new SpeechSynthesisUtterance(text);
  const sel = $('voiceSelect').value;
  if(sel){
    const v = voices.find(x=>x.name===sel);
    if(v) ut.voice = v;
  }
  ut.rate = parseFloat($('rate').value);
  ut.pitch = parseFloat($('pitch').value);
  synth.speak(ut);
});
$('stopRead').addEventListener('click', ()=> synth.cancel());

/* ------------------ Text Tools ------------------ */
function simpleSummarize(text, maxSent=3){
  if(!text) return '';
  const sents = text.match(/[^\.!\?]+[\.!\?]+/g) || [text];
  const freq = {}; const stop = new Set(['the','is','and','a','an','of','to','in','that','it','for','on','with','as','are','was','be','by','this','i','you']);
  sents.forEach(sent=>{
    sent.toLowerCase().replace(/[^a-z0-9\s]/g,'').split(/\s+/).forEach(w=>{
      if(!w) return; if(stop.has(w)) return; freq[w] = (freq[w]||0)+1;
    });
  });
  const scores = sents.map(sent=>{
    let sc=0; sent.toLowerCase().replace(/[^a-z0-9\s]/g,'').split(/\s+/).forEach(w=>{ if(freq[w]) sc += freq[w]; }); return sc;
  });
  const idx = scores.map((v,i)=>[v,i]).sort((a,b)=>b[0]-a[0]).slice(0,maxSent).sort((a,b)=>a[1]-b[1]);
  return idx.map(x=>sents[x[1]].trim()).join(' ');
}
$('summBtn').addEventListener('click', ()=> {
  const t = $('textInput').value; $('textOutput').value = simpleSummarize(t,3);
});
$('paraBtn').addEventListener('click', ()=> {
  const t = $('textInput').value; if(!t) return alert('Paste text first');
  const map = {'important':'crucial','use':'utilize','help':'assist','buy':'purchase','get':'obtain','said':'stated','really':'truly','very':'extremely'};
  const out = t.replace(/\b(\w+)\b/g, (m)=> map[m.toLowerCase()] || m);
  $('textOutput').value = out;
});
$('copyText').addEventListener('click', ()=> navigator.clipboard.writeText($('textOutput').value).then(()=>alert('Copied')));
$('clearText').addEventListener('click', ()=> { $('textInput').value=''; $('textOutput').value=''; localStorage.removeItem('addy_text'); });

/* autosave text */
setInterval(()=> {
  const v = $('textInput').value || '';
  if(v && v.length>20) localStorage.setItem('addy_text', v);
}, 5000);
/* restore */
window.addEventListener('load', ()=> {
  const saved = localStorage.getItem('addy_text'); if(saved) $('textInput').value = saved;
});

/* ------------------ Drawing Canvas ------------------ */
const drawCanvas = $('drawCanvas'), dctx = drawCanvas.getContext('2d');
let drawState = { size: parseInt($('brushSize').value), color: $('brushColor').value, drawing:false, paths:[], undone:[] };

function initDrawCanvas(){
  const sz = parseInt($('drawSize').value);
  drawCanvas.width = sz; drawCanvas.height = Math.round(sz * 0.75);
  // clear
  dctx.fillStyle = '#021018'; dctx.fillRect(0,0,drawCanvas.width,drawCanvas.height);
  drawState.paths = []; drawState.undone = [];
}
initDrawCanvas();

function startDraw(x,y){ drawState.drawing = true; const p = {tool:'pen', color: drawState.color, size: drawState.size, points:[{x,y}]}; drawState.paths.push(p); }
function continueDraw(x,y){ if(!drawState.drawing) return; const p = drawState.paths[drawState.paths.length-1]; p.points.push({x,y}); redrawPaths(); }
function endDraw(){ drawState.drawing = false; }

function redrawPaths(){
  dctx.clearRect(0,0,drawCanvas.width,drawCanvas.height);
  dctx.fillStyle = '#021018'; dctx.fillRect(0,0,drawCanvas.width,drawCanvas.height);
  for(const stroke of drawState.paths){
    dctx.strokeStyle = stroke.color; dctx.lineWidth = stroke.size; dctx.lineJoin = 'round'; dctx.lineCap='round';
    dctx.beginPath();
    const pts = stroke.points;
    if(pts.length>0){ dctx.moveTo(pts[0].x, pts[0].y); for(let i=1;i<pts.length;i++){ dctx.lineTo(pts[i].x, pts[i].y); } dctx.stroke(); }
  }
}

drawCanvas.addEventListener('pointerdown', (e)=> {
  const rect = drawCanvas.getBoundingClientRect(); startDraw(e.clientX-rect.left, e.clientY-rect.top);
});
drawCanvas.addEventListener('pointermove', (e)=> {
  if(!drawState.drawing) return; const rect = drawCanvas.getBoundingClientRect(); continueDraw(e.clientX-rect.left, e.clientY-rect.top);
});
window.addEventListener('pointerup', ()=> endDraw());

$('brushSize').addEventListener('input', ()=> drawState.size = parseInt($('brushSize').value));
$('brushColor').addEventListener('input', ()=> drawState.color = $('brushColor').value);
$('drawSize').addEventListener('change', ()=> initDrawCanvas());
$('clearCanvas').addEventListener('click', ()=> { initDrawCanvas(); });
$('undoBtn').addEventListener('click', ()=> { if(drawState.paths.length) drawState.undone.push(drawState.paths.pop()); redrawPaths(); });
$('saveDraw').addEventListener('click', ()=> {
  const a = document.createElement('a'); a.href = drawCanvas.toDataURL('image/png'); a.download = 'addy_draw.png'; a.click();
});

/* ------------------ Session export/import & quick actions ------------------ */
$('clearAllBtn').addEventListener('click', ()=> {
  // clear editor, draw, text and voice
  edImg = new Image(); edOriginal = null; edCurrentData = null; try{ ectx.clearRect(0,0,editorCanvas.width,editorCanvas.height);}catch(e){}
  initDrawCanvas(); $('textInput').value=''; $('textOutput').value=''; $('voiceText').value=''; $('ocrResult') && ($('ocrResult').value='');
  alert('Cleared all (client only)');
});
$('exportSession').addEventListener('click', ()=> {
  const sess = { editor: edCurrentData || edOriginal, text: $('textInput').value, notes: $('sessionNotes').value, draw: drawCanvas.toDataURL() };
  const blob = new Blob([JSON.stringify(sess,null,2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'addy_session.json'; a.click();
});
$('importSession').addEventListener('click', ()=> $('importFile').click());
$('importFile').addEventListener('change', (e)=> {
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader(); reader.onload = ev=>{
    try{
      const data = JSON.parse(ev.target.result);
      if(data.editor){ edImg = new Image(); edImg.onload = ()=> { edOriginal = data.editor; fitEditorCanvas(); }; edImg.src = data.editor; }
      if(data.draw){ const img = new Image(); img.onload = ()=> { dctx.clearRect(0,0,drawCanvas.width,drawCanvas.height); dctx.drawImage(img,0,0); }; img.src = data.draw; }
      $('textInput').value = data.text || ''; $('sessionNotes').value = data.notes || '';
      alert('Session imported');
    }catch(err){ alert('Import error: '+err.message); }
  }; reader.readAsText(f);
});

/* ------------------ Simple OCR placeholder (will add in Part-2 full Tesseract UI) ------------------ */
const ocrEl = $('ocrResult');
if(ocrEl) ocrEl.value = '';

/* ------------------ Request next part / deploy pack ------------------ */
$('nextPart').addEventListener('click', ()=> alert('I will prepare Part-2 (BodyPix, OCR improvements, embed list). Reply "next" if you want it now.'));
$('askDeploy').addEventListener('click', ()=> alert('I will prepare a GitHub-ready zip pack (index.html) for one-click upload. Reply "deploy" to request it.'));

window.addEventListener('load', ()=> {
  // set a tiny timeout to ensure voices populated
  setTimeout(()=> { if(speechSynthesis.getVoices().length) populateVoices(); }, 500);
  initDrawCanvas();
});

</script>
</body>
</html><!-- ADDY Part-2 (1/4): Enhance + Background Remove -->
<script>
/* ----------- 8K-style Image Enhancer (client-side pseudo upscaler) ----------- */
function enhanceImage(canvas){
  const ctx = canvas.getContext('2d');
  let imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
  let d = imgData.data;

  // simple unsharp mask
  let blur = ctx.getImageData(0,0,canvas.width,canvas.height);
  const k=[1,2,1,2,4,2,1,2,1];
  for(let y=1;y<canvas.height-1;y++){
    for(let x=1;x<canvas.width-1;x++){
      for(let c=0;c<3;c++){
        let sum=0,idx=0;
        for(let ky=-1;ky<=1;ky++){
          for(let kx=-1;kx<=1;kx++){
            const i=((y+ky)*canvas.width+(x+kx))*4+c;
            sum+=blur.data[i]*k[idx++];
          }
        }
        const i2=(y*canvas.width+x)*4+c;
        const val=d[i2]+(d[i2]-sum/16)*0.5; // sharpen
        d[i2]=Math.min(255,Math.max(0,val));
      }
    }
  }
  // contrast stretch
  let rMin=255,rMax=0,gMin=255,gMax=0,bMin=255,bMax=0;
  for(let i=0;i<d.length;i+=4){
    const r=d[i],g=d[i+1],b=d[i+2];
    if(r<rMin)rMin=r;if(r>rMax)rMax=r;
    if(g<gMin)gMin=g;if(g>gMax)gMax=g;
    if(b<bMin)bMin=b;if(b>bMax)bMax=b;
  }
  for(let i=0;i<d.length;i+=4){
    d[i]=(d[i]-rMin)/(rMax-rMin||1)*255;
    d[i+1]=(d[i+1]-gMin)/(gMax-gMin||1)*255;
    d[i+2]=(d[i+2]-bMin)/(bMax-bMin||1)*255;
  }
  ctx.putImageData(imgData,0,0);
  alert("Enhanced (pseudo-8K look)");
}
const enhanceBtn = document.createElement('button');
enhanceBtn.textContent="Ultra Enhance (8K-style)";
enhanceBtn.className="btn";
enhanceBtn.onclick=()=> enhanceImage(editorCanvas);
$('applyEd').after(enhanceBtn);

/* ----------- Background Remove (BodyPix lite) ----------- */
async function loadBodyPix(){
  if(window.bodyPixLoaded) return window.bodyPixNet;
  const script=document.createElement('script');
  script.src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js";
  document.body.appendChild(script);
  await new Promise(r=>script.onload=r);
  const script2=document.createElement('script');
  script2.src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.2.0";
  document.body.appendChild(script2);
  await new Promise(r=>script2.onload=r);
  window.bodyPixLoaded=true;
  window.bodyPixNet=await bodyPix.load();
  return window.bodyPixNet;
}

async function removeBg(){
  if(!edImg.src) return alert('Upload an image first');
  const net = await loadBodyPix();
  const tmp=document.createElement('canvas');
  tmp.width=edImg.naturalWidth; tmp.height=edImg.naturalHeight;
  const ctx2=tmp.getContext('2d');
  ctx2.drawImage(edImg,0,0);
  const segmentation=await net.segmentPerson(tmp);
  const imageData=ctx2.getImageData(0,0,tmp.width,tmp.height);
  for(let i=0;i<segmentation.data.length;i++){
    if(segmentation.data[i]===0) imageData.data[i*4+3]=0;
  }
  ctx2.putImageData(imageData,0,0);
  edImg.src=tmp.toDataURL();
  edOriginal=edImg.src;
  fitEditorCanvas();
  alert("Background removed (BodyPix)");
}
const bgBtn=document.createElement('button');
bgBtn.textContent="Remove BG (Lite)";
bgBtn.className="btn alt";
bgBtn.onclick=removeBg;
$('applyEd').after(bgBtn);
</script>
<!-- END Part-2 (1/4) --><!-- ADDY Part-2 (2/4): OCR + Palette Extractor + Auto-Backup -->
<script>
/* ================= OCR (Tesseract.js lite) ================= */
async function loadTesseract(){
  if(window.TessLoaded) return window.Tesseract;
  const s=document.createElement('script');
  s.src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js";
  document.body.appendChild(s);
  await new Promise(r=>s.onload=r);
  window.TessLoaded=true;
  return window.Tesseract;
}
async function runOCR(){
  if(!edImg.src) return alert("Upload an image first");
  const T=await loadTesseract();
  const worker=T.createWorker();
  await worker.loadLanguage('eng');
  await worker.initialize('eng');
  const result=await worker.recognize(edImg.src);
  await worker.terminate();
  const txt=result.data.text.trim();
  if(!txt){alert("No text found");return;}
  localStorage.setItem('addy_ocr',txt);
  alert("OCR Done ‚úì  Text copied below output box");
  // create output area if not exists
  let box=document.getElementById('ocrBox');
  if(!box){
    box=document.createElement('textarea');
    box.id='ocrBox';
    box.placeholder='Extracted text will appear here...';
    box.style.width='100%';box.style.minHeight='120px';
    box.style.marginTop='10px';box.style.background='rgba(255,255,255,0.03)';
    box.style.color='#fff';
    $('editor').appendChild(box);
  }
  box.value=txt;
}
const ocrBtn=document.createElement('button');
ocrBtn.textContent="Run OCR (Read Text)";
ocrBtn.className="btn";
ocrBtn.onclick=runOCR;
$('applyEd').after(ocrBtn);

/* ================= Palette Extractor ================= */
function extractPalette(){
  if(!edImg.src) return alert("Upload an image first");
  const ctx=editorCanvas.getContext('2d');
  const imgData=ctx.getImageData(0,0,editorCanvas.width,editorCanvas.height).data;
  const colors={}, step=20;
  for(let i=0;i<imgData.length;i+=4*step){
    const r=imgData[i],g=imgData[i+1],b=imgData[i+2];
    const key=`${r>>4}${g>>4}${b>>4}`;
    colors[key]={r,g,b};
  }
  const keys=Object.keys(colors).slice(0,12);
  let wrap=document.getElementById('paletteWrap');
  if(!wrap){
    wrap=document.createElement('div');
    wrap.id='paletteWrap';
    wrap.style.display='flex';
    wrap.style.flexWrap='wrap';
    wrap.style.marginTop='10px';
    $('editor').appendChild(wrap);
  }
  wrap.innerHTML='';
  keys.forEach(k=>{
    const {r,g,b}=colors[k];
    const hex="#"+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('');
    const box=document.createElement('div');
    box.style.width='60px';box.style.height='60px';
    box.style.borderRadius='8px';
    box.style.margin='4px';
    box.style.background=hex;
    box.title=hex;
    box.onclick=()=>{navigator.clipboard.writeText(hex);alert(`Copied ${hex}`);};
    wrap.appendChild(box);
  });
  alert("Palette generated ‚Äî tap a color to copy its HEX");
}
const palBtn=document.createElement('button');
palBtn.textContent="Palette Extract";
palBtn.className="btn alt";
palBtn.onclick=extractPalette;
$('applyEd').after(palBtn);

/* ================= Auto-Backup / Restore ================= */
function autoSave(){
  try{
    const session={
      img:edCurrentData||edOriginal,
      text:$('textInput').value,
      notes:$('sessionNotes').value
    };
    localStorage.setItem('addy_auto',JSON.stringify(session));
  }catch(e){console.warn('autosave fail',e);}
}
setInterval(autoSave,15000);
window.addEventListener('load',()=>{
  const d=localStorage.getItem('addy_auto');
  if(!d)return;
  try{
    const s=JSON.parse(d);
    if(s.img){edImg=new Image();edImg.onload=()=>{edOriginal=s.img;fitEditorCanvas();};edImg.src=s.img;}
    if(s.text)$('textInput').value=s.text;
    if(s.notes)$('sessionNotes').value=s.notes;
  }catch(e){console.log('restore fail',e);}
});
</script>
<!-- END Part-2 (2/4) --><!-- ADDY Part-2 (3/4): AI Chat (local) + HF Embed option + QR Gen/Scan + Quotes widget -->
<!-- Paste this block before </body> in your index.html -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

<script>
/* ========== ADDY: Chat + QR + Quotes Module ========== */

/* Helper to create tabs & content dynamically (adds "Chat" tab) */
(function createChatTab(){
  try{
    const tabs = document.getElementById('tabs');
    if(!tabs) return console.warn('Tabs element not found ‚Äî ensure Part-1 present');
    // avoid duplicate
    if(document.querySelector('.tab[data-tab="chat"]')) return;
    const chatTab = document.createElement('div');
    chatTab.className='tab';
    chatTab.dataset.tab='chat';
    chatTab.textContent='AI Chat';
    tabs.appendChild(chatTab);
    chatTab.addEventListener('click', ()=> {
      // activate tab UI (reuse existing showTab if available)
      if(typeof showTab === 'function'){ showTab('chat'); }
      else {
        // fallback: hide others, show created
        ['editor','voice','text','draw','help','chat'].forEach(t=>{
          const el = document.getElementById(t);
          if(el) el.style.display = (t==='chat' ? 'block' : 'none');
        });
        document.querySelectorAll('#tabs .tab').forEach(tab=> tab.classList.toggle('active', tab===chatTab));
      }
    });

    // create chat content card
    const contentWrap = document.getElementById('content') || document.body;
    const chatCard = document.createElement('div');
    chatCard.className='card';
    chatCard.id='chat';
    chatCard.style.display='none';
    chatCard.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h2 style="margin:0">ü§ñ ADDY Chat (Local)</h2>
          <div class="small">Offline-friendly assistant + option to embed a live HF Space chat.</div>
        </div>
        <div class="hint">Tip: Use "Embed HF Chat" to connect a public Space (no key)</div>
      </div>
      <hr/>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div style="flex:1;min-width:320px">
          <div id="chatBox" style="height:360px;overflow:auto;border-radius:8px;padding:12px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="chatInput" placeholder="Type a message..." style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#eaf7ff">
            <button id="sendChat" class="btn">Send</button>
            <button id="gptEmbedBtn" class="btn alt">Embed HF Chat</button>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="quickHello" class="btn">Say Hi</button>
            <button id="quickHelp" class="btn alt">How to earn</button>
            <button id="quickSEO" class="btn">Make site better</button>
          </div>
        </div>

        <div style="width:360px">
          <div class="small" style="margin-bottom:6px"><strong>Embed / Full LLM</strong></div>
          <input id="embedChatUrl" placeholder="Paste public HuggingFace Space URL (https://...)" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#eaf7ff">
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="doEmbed" class="btn">Embed</button>
            <button id="removeEmbed" class="btn alt">Remove</button>
          </div>
          <div id="embedArea" style="margin-top:10px;height:260px;border-radius:8px;overflow:hidden;background:#000;border:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;color:var(--muted)">No embed</div>
        </div>
      </div>
      <hr/>
      <div class="small">Local chat uses fast rule-based and creative fallback generation. For full LLM behaviour embed a public HF Space in the box above.</div>
    `;
    // insert after main content start
    contentWrap.insertBefore(chatCard, contentWrap.firstChild.nextSibling);
  }catch(e){console.error(e);}
})();

/* ========== Simple local Chatbot engine ========== */
(function chatEngine(){
  const chatBox = () => document.getElementById('chatBox');
  const input = () => document.getElementById('chatInput');

  function appendMessage(who, text){
    const box = chatBox();
    if(!box) return;
    const el = document.createElement('div');
    el.style.marginBottom='8px';
    el.innerHTML = `<div style="font-size:13px;color:${who==='user'?'#cfe9ff':'#022827'};display:inline-block;max-width:85%;padding:8px;border-radius:8px;background:${who==='user'?'rgba(0,0,0,0.25)':'linear-gradient(90deg,#00d4ff,#4ce6a1)'};color:${who==='user'?'#eaf7ff':'#012827'}">${text.replace(/\n/g,'<br>')}</div>`;
    box.appendChild(el);
    box.scrollTop = box.scrollHeight;
  }

  function generateReply(msg){
    // simple rule-based checks (case-insensitive)
    const t = (msg||'').toLowerCase();
    if(!t.trim()) return "Bata bhai, kuch likh!"; 
    const greetings = ['hi','hello','hey','yo','namaste'];
    for(const g of greetings){ if(t.includes(g)) return `Hey! Main ADDY hoon ‚Äî bata kya karna hai aaj?`;}

    if(t.includes('price') || t.includes('kitne') || t.includes('sell') || t.includes('bech')){
      return "Agar tu site bechna chahta hai to pehle design polish, traffic proof (analytics) aur custom domain add kar. Basic buyers ‚Çπ3k‚Äì10k tak de sakte hain; traffic/monetization ho to ‚Çπ30k+. Main help kar dunga listing text aur pitch.";
    }
    if(t.includes('how') && t.includes('earn') || t.includes('kamai') || t.includes('paise')){
      return "Start free freelancing: gigs bana, Fiverr/Upwork pe listing, ya template-selling (web templates). Tu ADDY tools se social posts bana ke organic traffic le sakta hai ‚Äî main step-by-step plan bana dunga agar chaahe.";
    }
    if(t.includes('bg') || t.includes('background')){
      return "Background remove toggle BodyPix use kar ‚Äî Image Editor ‚Üí Remove BG (Lite). Agar background complex hai to try 'Fit' then 'Remove BG' for better results.";
    }
    if(t.includes('ocr') || t.includes('text')){
      return "OCR button Image Editor me hai ‚Äî use kar aur text ko summarize/translate kar. Agar text poor quality ho to Auto-Enhance pehle chala.";
    }
    if(t.includes('embed') || t.includes('huggingface') || t.includes('space')){
      return "Embed a public HuggingFace Space URL in 'Embed HF Chat' box and click Embed. If the Space allows iframe, it'll load directly.";
    }
    // fallback: creative reply (mix)
    const fallbacks = [
      "Mast idea! Bata aur detail ‚Äî main ek plan bana ke deta hoon.",
      "Yeh feasible hai. Chota proof bana ke dikha: 1) deploy 2) share 3) collect feedback.",
      "Sahi socha ‚Äî main teri madad karunga step-by-step, bata pehla target kya hai (traffic/earn/sell).",
      "Chalo ‚Äî 1 hour me ek landing page bana kar de dunga. Ready?"
    ];
    // small transformation: repeat with enthusiasm
    return fallbacks[Math.floor(Math.random()*fallbacks.length)];
  }

  function send(){
    const txt = input().value.trim();
    if(!txt) return;
    appendMessage('user', txt);
    input().value = '';
    // simulate thinking
    appendMessage('bot', '...thinking');
    setTimeout(()=> {
      // remove last '...thinking'
      const box = chatBox();
      if(box && box.lastChild){ box.removeChild(box.lastChild); }
      const reply = generateReply(txt);
      appendMessage('bot', reply);
    }, 600 + Math.random()*700);
  }

  document.addEventListener('click', function(e){
    if(e.target && e.target.id==='sendChat'){ send(); }
    if(e.target && e.target.id==='quickHello'){ document.getElementById('chatInput').value='Hello'; send(); }
    if(e.target && e.target.id==='quickHelp'){ document.getElementById('chatInput').value='How can I earn online with this site?'; send(); }
    if(e.target && e.target.id==='quickSEO'){ document.getElementById('chatInput').value='How to improve site for buyers?'; send(); }
  });

  // Enter key
  document.addEventListener('keydown', function(e){
    if(e.key==='Enter' && document.activeElement && document.activeElement.id==='chatInput'){ e.preventDefault(); send(); }
  });
})();

/* ========== Embed HF Chat actions ========== */
(function embedActions(){
  const embedBtn = document.getElementById('doEmbed');
  const removeBtn = document.getElementById('removeEmbed');
  embedBtn && embedBtn.addEventListener('click', ()=>{
    const url = document.getElementById('embedChatUrl').value.trim();
    if(!url) return alert('Paste a public https://huggingface.co/spaces/... URL that allows embedding');
    if(!url.startsWith('https://')) return alert('Use https:// URL');
    const frame = document.createElement('iframe');
    frame.src = url;
    frame.style.width='100%'; frame.style.height='100%'; frame.style.border='0';
    const area = document.getElementById('embedArea');
    area.innerHTML=''; area.appendChild(frame);
  });
  removeBtn && removeBtn.addEventListener('click', ()=>{
    const area = document.getElementById('embedArea');
    area.innerHTML = 'No embed';
    document.getElementById('embedChatUrl').value = '';
  });
})();

/* ========== QR Generator & Scanner (creates new UI panel) ========== */
(function qrModule(){
  // create a small card under right side or append to content
  const side = document.querySelector('.side') || document.querySelector('.card') || document.body;
  const card = document.createElement('div');
  card.className='card';
  card.style.marginTop='12px';
  card.innerHTML = `
    <h3 style="margin:0">üîó QR Tools</h3>
    <hr/>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <input id="qrText" placeholder="Text / URL to encode" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#eaf7ff">
      <button id="makeQR" class="btn">Generate</button>
      <button id="downloadQR" class="btn alt">Download</button>
    </div>
    <div id="qrcode" style="margin-top:8px;display:flex;align-items:center;justify-content:center;min-height:120px"></div>
    <hr/>
    <div><strong>Scan QR (camera)</strong></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="startScan" class="btn">Start Scan</button>
      <button id="stopScan" class="btn alt">Stop Scan</button>
    </div>
    <div id="scanArea" style="margin-top:8px;min-height:140px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);border-radius:8px">Scanner off</div>
  `;
  side.appendChild(card);

  // QR create
  let qrObj = null;
  document.addEventListener('click', function(e){
    if(e.target && e.target.id==='makeQR'){
      const v = document.getElementById('qrText').value.trim();
      if(!v) return alert('Type text or URL to encode');
      const wrap = document.getElementById('qrcode');
      wrap.innerHTML = '';
      qrObj = new QRCode(wrap, { text: v, width: 180, height: 180 });
    }
    if(e.target && e.target.id==='downloadQR'){
      if(!qrObj){
        return alert('Generate QR first');
      }
      // canvas img exists inside qrcode div or an img
      const wrap = document.getElementById('qrcode');
      const img = wrap.querySelector('img');
      if(img){
        const a = document.createElement('a'); a.href = img.src; a.download='addy_qr.png'; a.click();
      } else {
        // try toDataURL fallback
        const canvas = wrap.querySelector('canvas');
        if(canvas){ const a=document.createElement('a'); a.href = canvas.toDataURL(); a.download='addy_qr.png'; a.click(); }
      }
    }
  });

  /* QR Scanner using getUserMedia + jsQR */
  let scanStream = null, scanReqId = null;
  async function startScanner(){
    const area = document.getElementById('scanArea');
    area.innerHTML = '';
    const video = document.createElement('video'); video.style.width='100%'; video.style.maxHeight='320px';
    area.appendChild(video);
    try{
      scanStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode:'environment' }, audio:false });
      video.srcObject = scanStream; await video.play();
      const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
      async function scanFrame(){
        if(video.readyState !== video.HAVE_ENOUGH_DATA){ scanReqId = requestAnimationFrame(scanFrame); return; }
        canvas.width = video.videoWidth; canvas.height = video.videoHeight;
        ctx.drawImage(video,0,0,canvas.width,canvas.height);
        const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
        const code = jsQR(imageData.data, imageData.width, imageData.height);
        if(code){
          // show result
          cancelAnimationFrame(scanReqId);
          stopScanner();
          area.innerHTML = `<div style="padding:10px">‚úÖ Scanned: <a href="${escapeHtml(code.data)}" target="_blank">${escapeHtml(code.data)}</a></div>`;
          return;
        } else {
          scanReqId = requestAnimationFrame(scanFrame);
        }
      }
      scanReqId = requestAnimationFrame(scanFrame);
    }catch(err){
      area.innerHTML = `Camera error: ${err.message}`;
    }
  }
  function stopScanner(){
    if(scanReqId) cancelAnimationFrame(scanReqId);
    if(scanStream){
      scanStream.getTracks().forEach(t=>t.stop());
      scanStream=null;
    }
    const area = document.getElementById('scanArea'); area.innerHTML='Scanner off';
  }
  document.getElementById('startScan').addEventListener('click', startScanner);
  document.getElementById('stopScan').addEventListener('click', stopScanner);

  function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];}); }
})();

/* ========== Quotes Widget ========== */
(function quotesWidget(){
  const side = document.querySelector('.side') || document.querySelector('.card') || document.body;
  const card = document.createElement('div');
  card.className='card';
  card.style.marginTop='12px';
  card.innerHTML = `
    <h3 style="margin:0">üí¨ Quick Quotes</h3><hr/>
    <div id="quoteText" style="min-height:80px;display:flex;align-items:center;justify-content:center;padding:10px;font-weight:600;color:#eaf7ff">Click Get Quote</div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="getQuote" class="btn">Get Quote</button>
      <button id="copyQuote" class="btn alt">Copy</button>
      <button id="shareQuote" class="btn">Share</button>
    </div>
  `;
  side.appendChild(card);

  const quotes = [
    "‡§∞‡•Å‡§ï‡§®‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‚Äî ‡§¨‡§∏ ‡§è‡§ï ‡§î‡§∞ ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•ã‡•§",
    "‡§õ‡•ã‡§ü‡•Ä ‡§ú‡•Ä‡§§‡•á‡§Ç ‡§≠‡•Ä ‡§¨‡§°‡§º‡•Ä ‡§Æ‡§Ç‡§ú‡§º‡§ø‡§≤‡•ã‡§Ç ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç‡•§",
    "‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§ó‡§æ ‡§á‡§Ç‡§∏‡§æ‡§®, ‡§§‡•ã ‡§ï‡§ø‡§∏‡•ç‡§Æ‡§§ ‡§≠‡•Ä ‡§∏‡§æ‡§• ‡§¶‡•á‡§ó‡•Ä‡•§",
    "‡§π‡§∞ ‡§∏‡•Å‡§¨‡§π ‡§è‡§ï ‡§®‡§Ø‡§æ ‡§Æ‡•å‡§ï‡§æ ‡§π‡•à ‚Äî ‡§â‡§†‡•ã ‡§î‡§∞ ‡§ï‡§∞‡•ã‡•§",
    "‡§ó‡§≤‡§§‡§ø‡§Ø‡§æ‡§Å ‡§∏‡•Ä‡§ñ‡§®‡•á ‡§ï‡§æ ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§π‡•à‡§Ç ‚Äî ‡§π‡§æ‡§∞ ‡§ï‡§∞ ‡§Æ‡§§ ‡§¨‡•à‡§†‡•ã‡•§",
    "‡§ï‡§≠‡•Ä-‡§ï‡§≠‡•Ä ‡§ß‡•Ä‡§Æ‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§π‡•à ‚Äî ‡§∞‡•Å‡§ï‡§®‡§æ ‡§®‡§π‡•Ä‡§Ç‡•§"
  ];

  document.addEventListener('click', function(e){
    if(e.target && e.target.id==='getQuote'){
      const q = quotes[Math.floor(Math.random()*quotes.length)];
      document.getElementById('quoteText').innerText = q;
    }
    if(e.target && e.target.id==='copyQuote'){
      const t = document.getElementById('quoteText').innerText;
      if(t) navigator.clipboard.writeText(t).then(()=> alert('Copied quote'));
    }
    if(e.target && e.target.id==='shareQuote'){
      const t = document.getElementById('quoteText').innerText;
      if(!t) return;
      if(navigator.share){ navigator.share({ text:t }).catch(()=>{}); }
      else { navigator.clipboard.writeText(t).then(()=> alert('No share API ‚Äî copied instead')); }
    }
  });
})();

/* ========== End of Module ========= */
</script>
<!-- END ADDY Part-2 (3/4) --><!-- ADDY: Buyer-Friendly Hero + Features + Pricing CTA (paste into <body>) -->
<section id="sale-hero" style="padding:24px;background:linear-gradient(90deg,#02101a,#052333);color:#e9fbff;border-radius:12px;margin:12px 0;">
  <div style="max-width:1100px;margin:0 auto;display:flex;gap:18px;align-items:center;flex-wrap:wrap;">
    <div style="flex:1;min-width:280px">
      <h1 style="margin:0;font-size:28px;color:#7ef0ff">ADDY ‚Äî Ready-to-sell AI Tools Hub</h1>
      <p style="color:#cfeefb;margin:10px 0;">One-page, deploy-ready AI tools collection ‚Äî Image Editor, BG Remove, OCR, Speech‚ÜíText, Chat, QR, Palette, and more. Perfect for reselling or white-label use.</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <a href="#buyer-pack" style="background:#00d4ff;color:#012827;padding:10px 14px;border-radius:8px;font-weight:700;text-decoration:none;">Buyer Pack (Download)</a>
        <a href="#demo" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#eaf7ff;padding:10px 14px;border-radius:8px;text-decoration:none;">Live Demo</a>
      </div>
      <div style="margin-top:12px;color:#bfe9f8;font-size:13px;">
        <strong>Why buy?</strong> Fully client-side, no paid keys, easy GitHub Pages deploy, mobile-friendly, docs & transfer checklist included.
      </div>
    </div>
    <div style="width:360px;min-width:260px">
      <div style="background:#021d26;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)">
        <div style="font-size:13px;color:#9fd8ea">What's included</div>
        <ul style="margin:8px 0 0 18px;color:#dff8ff">
          <li>Full single-file index.html (frontend)</li>
          <li>Part-1 (editor/draw/text/voice)</li>
          <li>Part-2 (enhance/bg remove/ocr/palette/qr/quotes)</li>
          <li>Buyer Pack: README, LICENSE, deploy guide</li>
        </ul>
        <div style="margin-top:12px">
          <div style="font-size:12px;color:#cfeefb">Asking price</div>
          <div style="font-weight:800;font-size:20px;margin-top:4px;color:#00ffc8">‚Çπ6,000 ‚Äî ‚Çπ12,000</div>
          <div style="font-size:12px;color:#9fb7d8;margin-top:6px">(negotiable; I will provide transfer instructions)</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Quick Features Grid -->
<section id="sale-features" style="max-width:1100px;margin:12px auto;padding:12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
  <div style="background:#08212a;padding:12px;border-radius:8px">
    <h4 style="margin:0;color:#7ef0ff">Image Editor</h4>
    <p class="small" style="color:#bfe9f8">Filters, crop, pseudo-enhance, download ‚Äî mobile friendly.</p>
  </div>
  <div style="background:#08212a;padding:12px;border-radius:8px">
    <h4 style="margin:0;color:#7ef0ff">Background Remove</h4>
    <p class="small" style="color:#bfe9f8">BodyPix client-side remove; works on portraits.</p>
  </div>
  <div style="background:#08212a;padding:12px;border-radius:8px">
    <h4 style="margin:0;color:#7ef0ff">OCR + Speech</h4>
    <p class="small" style="color:#bfe9f8">Tesseract.js OCR + Web Speech API for speech/text.</p>
  </div>
  <div style="background:#08212a;padding:12px;border-radius:8px">
    <h4 style="margin:0;color:#7ef0ff">Chat & Tools</h4>
    <p class="small" style="color:#bfe9f8">Local rule-based chat + HF embed option, QR, palette, quotes.</p>
  </div>
</section>

<!-- Buyer Pack anchor (hidden download link will be added by script) -->
<section id="buyer-pack" style="max-width:1100px;margin:8px auto;padding:12px">
  <h3 style="color:#cfeefb">Buyer Pack (what you get)</h3>
  <ol style="color:#dff8ff">
    <li>Full index.html (ready to deploy on GitHub Pages)</li>
    <li>README.md with deploy & monetization steps</li>
    <li>LICENSE (MIT) and transfer checklist</li>
    <li>One-time 24-hour email support to help deploy (if you request)</li>
  </ol>
  <div style="margin-top:10px">
    <a id="downloadPackBtn" href="#" style="background:#00d4ff;color:#012827;padding:10px 14px;border-radius:8px;font-weight:700;text-decoration:none">Download Buyer Pack (ZIP)</a>
    <a href="mailto:your-email@example.com?subject=Interested%20in%20ADDY%20Buyer%20Pack" style="margin-left:10px;color:#9fb7d8;text-decoration:underline">Email to buy</a>
  </div>
</section>
<!-- END sale UI --><!-- ADDY Premium Intro Animation -->
<style>
  #introLoader {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at center, #00151f, #000a12);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    animation: fadeOut 1.4s ease-in-out forwards;
    animation-delay: 1.3s;
  }
  #introLoader .logo {
    font-family: 'Poppins', sans-serif;
    font-size: 2.2em;
    letter-spacing: 2px;
    color: #00e6ff;
    text-shadow: 0 0 12px #00ffffaa;
    animation: pulse 1.2s ease-in-out infinite alternate;
  }
  @keyframes pulse {
    from { transform: scale(1); opacity: 0.8; }
    to { transform: scale(1.2); opacity: 1; }
  }
  @keyframes fadeOut {
    to { opacity: 0; visibility: hidden; }
  }
</style>

<div id="introLoader">
  <div class="logo">ADDY.AI</div>
</div>

<script>
  // small delay so animation completes before hide
  setTimeout(()=> document.getElementById('introLoader').style.display='none', 1500);
</script>
<!-- END Premium Intro --><!-- ADDY: Voice Recorder + Light Noise Filter -->
<style>
  #voiceBox{
    background:#081e26;
    border:1px solid rgba(255,255,255,0.05);
    border-radius:12px;
    padding:14px;
    margin:12px 0;
    color:#cfeefb;
  }
  #recStatus{font-size:13px;color:#7ef0ff;margin-top:6px;}
  #audioPlayer{margin-top:10px;width:100%;}
  .btnV{background:#00d4ff;color:#012827;padding:8px 14px;border-radius:8px;border:none;font-weight:600;cursor:pointer;margin:4px;}
</style>

<div id="voiceBox">
  <h3>üé§ Voice Enhance (Lite)</h3>
  <p class="small">Record your voice (up to 30s), auto-filter light background noise and download.</p>
  <div>
    <button id="startRec" class="btnV">Start Recording</button>
    <button id="stopRec" class="btnV">Stop</button>
    <button id="playRec" class="btnV">Play</button>
    <button id="downloadRec" class="btnV">Download</button>
  </div>
  <div id="recStatus">Idle</div>
  <audio id="audioPlayer" controls></audio>
</div>

<script>
let mediaRecorder, audioChunks=[], audioBlob=null, timer=null;

async function startRecording(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({audio:true});
    mediaRecorder = new MediaRecorder(stream);
    audioChunks=[];
    mediaRecorder.ondataavailable = e=>audioChunks.push(e.data);
    mediaRecorder.onstop = async ()=>{
      audioBlob = new Blob(audioChunks,{type:'audio/wav'});
      // Basic noise filter (high-pass)
      const arrayBuffer = await audioBlob.arrayBuffer();
      const ctx = new AudioContext();
      const buffer = await ctx.decodeAudioData(arrayBuffer);
      const source = ctx.createBufferSource();
      source.buffer = buffer;
      const biquad = ctx.createBiquadFilter();
      biquad.type = "highpass";
      biquad.frequency.value = 180; // remove low hum
      source.connect(biquad).connect(ctx.destination);
      source.start();
      const player = document.getElementById('audioPlayer');
      player.src = URL.createObjectURL(audioBlob);
    };
    mediaRecorder.start();
    document.getElementById('recStatus').innerText="Recording... (max 30s)";
    timer=setTimeout(stopRecording,30000);
  }catch(err){
    alert("Mic access error: "+err.message);
  }
}
function stopRecording(){
  if(mediaRecorder && mediaRecorder.state!=="inactive"){
    mediaRecorder.stop();
    document.getElementById('recStatus').innerText="Processing...";
    clearTimeout(timer);
  }
}
function playRecording(){
  const player=document.getElementById('audioPlayer');
  if(player.src){player.play();}
}
function downloadRecording(){
  if(!audioBlob)return alert("No recording yet");
  const a=document.createElement('a');
  a.href=URL.createObjectURL(audioBlob);
  a.download='enhanced_voice.wav';
  a.click();
}
document.getElementById('startRec').onclick=startRecording;
document.getElementById('stopRec').onclick=stopRecording;
document.getElementById('playRec').onclick=playRecording;
document.getElementById('downloadRec').onclick=downloadRecording;
</script>
<!-- END Voice Recorder --><!-- ADDY: Enhanced Voice Recorder + Noise-Reduce (client-side) -->
<style>
  /* Voice UI */
  .addy-voice {
    background:#071822;border:1px solid rgba(255,255,255,0.03);
    padding:14px;border-radius:12px;color:#dff8ff;margin:12px 0;
    box-shadow:0 8px 30px rgba(0,0,0,0.6);
  }
  .addy-voice .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .mic-btn{width:54px;height:54px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;
    border:0;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
  .mic-start{background:linear-gradient(135deg,#00e6ff,#00ffa3);color:#012827}
  .mic-stop{background:#ff6b6b;color:#1a0b0b}
  .control-btn{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.02);padding:8px 12px;border-radius:8px;color:#e9fbff}
  .status{font-size:13px;color:#9fd8ea;margin-top:8px}
  .wave-canvas{width:100%;height:80px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.02));margin-top:10px}
  .glow {filter:drop-shadow(0 0 12px rgba(0,230,255,0.12));}
  .tiny{font-size:12px;color:#9fb7d8}
</style>

<div class="addy-voice" id="addyVoiceEnhanced">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <h3 style="margin:0">üé§ Voice Enhance ‚Äî ADDY (Lite)</h3>
      <div class="tiny">Record up to 30s ‚Üí client-side enhance ‚Üí preview & download (WAV)</div>
    </div>
    <div style="text-align:right">
      <div id="micGlow" style="width:44px;height:44px;border-radius:8px;background:linear-gradient(90deg,#001a22,#003243);display:flex;align-items:center;justify-content:center" class="glow">
        <svg id="micIcon" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v5a3 3 0 0 0 3 3z" stroke="#7ef0ff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 11a7 7 0 0 1-14 0" stroke="#7ef0ff" stroke-width="1.4" stroke-linecap="round"/></svg>
      </div>
    </div>
  </div>

  <div class="row" style="margin-top:12px">
    <button id="addyStart" class="mic-btn mic-start">REC</button>
    <button id="addyStop" class="mic-btn mic-stop" disabled>STOP</button>
    <button id="addyPlay" class="control-btn" disabled>Play</button>
    <button id="addyDownload" class="control-btn" disabled>Download WAV</button>
    <div style="flex:1"></div>
    <div class="tiny">Limit: <strong>30s</strong></div>
  </div>

  <div class="status" id="addyStatus">Idle ‚Äî press REC</div>
  <canvas id="addyWave" class="wave-canvas"></canvas>

  <audio id="addyPlayer" controls style="width:100%;margin-top:10px"></audio>
</div>

<script>
/* ADDY Enhanced Voice Recorder + Simple Noise-Reduce using WebAudio + OfflineAudioContext
   - Records via MediaRecorder (webm/ogg or default)
   - Renders through OfflineAudioContext: highpass -> lowpass -> dynamic compression -> normalization
   - Produces WAV Blob for download
   - Shows live waveform while recording and static waveform after processing
*/

(() => {
  const startBtn = document.getElementById('addyStart');
  const stopBtn = document.getElementById('addyStop');
  const playBtn = document.getElementById('addyPlay');
  const dlBtn = document.getElementById('addyDownload');
  const statusEl = document.getElementById('addyStatus');
  const player = document.getElementById('addyPlayer');
  const waveCanvas = document.getElementById('addyWave');
  const canvasCtx = waveCanvas.getContext('2d');
  const micGlow = document.getElementById('micGlow');

  let mediaRecorder, chunks = [], stream = null, analyser=null, audioContext=null;
  let rafId=null, recordedBlob=null, processedBlob=null;
  let maxDuration = 30000; // 30s
  let recTimer = null;

  function setStatus(t){ statusEl.innerText = t; }

  function drawLiveWave() {
    if(!analyser) return;
    const bufferLength = analyser.fftSize;
    const dataArray = new Uint8Array(bufferLength);
    analyser.getByteTimeDomainData(dataArray);
    const w = waveCanvas.width = waveCanvas.clientWidth * devicePixelRatio;
    const h = waveCanvas.height = waveCanvas.clientHeight * devicePixelRatio;
    canvasCtx.clearRect(0,0,w,h);
    canvasCtx.fillStyle = 'rgba(0,0,0,0)';
    canvasCtx.fillRect(0,0,w,h);
    canvasCtx.lineWidth = 2 * devicePixelRatio;
    canvasCtx.strokeStyle = '#00f0ff';
    canvasCtx.beginPath();
    const sliceWidth = w / bufferLength;
    let x = 0;
    for(let i=0;i<bufferLength;i++){
      const v = dataArray[i] / 128.0;
      const y = (v * h / 2);
      if(i===0) canvasCtx.moveTo(x,y);
      else canvasCtx.lineTo(x,y);
      x += sliceWidth;
    }
    canvasCtx.lineTo(w, h/2);
    canvasCtx.stroke();
    rafId = requestAnimationFrame(drawLiveWave);
  }

  startBtn.addEventListener('click', async () => {
    try{
      setStatus('Requesting mic...');
      stream = await navigator.mediaDevices.getUserMedia({ audio: { sampleRate: 48000 } });
      audioContext = new AudioContext();
      const source = audioContext.createMediaStreamSource(stream);
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 2048;
      source.connect(analyser);
      drawLiveWave();

      // start MediaRecorder
      chunks = [];
      const options = { mimeType: 'audio/webm' };
      mediaRecorder = new MediaRecorder(stream, options);
      mediaRecorder.ondataavailable = e => { if(e.data && e.data.size>0) chunks.push(e.data); };
      mediaRecorder.onstart = () => {
        setStatus('Recording...');
        startBtn.disabled=true; stopBtn.disabled=false; playBtn.disabled=true; dlBtn.disabled=true;
        micGlow.style.boxShadow = '0 0 20px rgba(0,230,255,0.28), inset 0 0 12px rgba(0,230,255,0.06)';
      };
      mediaRecorder.onstop = async () => {
        setStatus('Recording stopped. Processing...');
        cancelAnimationFrame(rafId);
        // create raw blob
        recordedBlob = new Blob(chunks, { type: 'audio/webm' });
        // process using OfflineAudioContext
        processedBlob = await enhanceAndRender(recordedBlob);
        // set player src
        player.src = URL.createObjectURL(processedBlob);
        playBtn.disabled=false; dlBtn.disabled=false; startBtn.disabled=false; stopBtn.disabled=true;
        setStatus('Ready ‚Äî Play or Download');
        micGlow.style.boxShadow = '';
      };

      mediaRecorder.start();
      // auto-stop after maxDuration
      recTimer = setTimeout(()=> { if(mediaRecorder && mediaRecorder.state==='recording') mediaRecorder.stop(); }, maxDuration);
    }catch(err){
      console.error(err);
      alert('Microphone access denied or error: ' + err.message);
      setStatus('Error: mic access');
    }
  });

  stopBtn.addEventListener('click', ()=>{
    if(mediaRecorder && mediaRecorder.state==='recording') mediaRecorder.stop();
    if(recTimer) clearTimeout(recTimer);
  });

  playBtn.addEventListener('click', ()=> {
    if(player.src) player.play();
  });

  dlBtn.addEventListener('click', ()=> {
    if(!processedBlob) return alert('No audio processed yet');
    const a = document.createElement('a'); a.href = URL.createObjectURL(processedBlob); a.download = 'addy_enhanced.wav'; a.click();
  });

  /* ---------- Enhance pipeline using OfflineAudioContext ---------- */
  async function enhanceAndRender(blob){
    // decode to AudioBuffer using a temporary AudioContext
    const arrayBuffer = await blob.arrayBuffer();
    const decodeCtx = new (window.AudioContext || window.webkitAudioContext)();
    const decoded = await decodeCtx.decodeAudioData(arrayBuffer);

    // create offline context same length
    const sampleRate = 44100;
    const offlineCtx = new OfflineAudioContext(decoded.numberOfChannels, decoded.length, sampleRate);

    // source
    const src = offlineCtx.createBufferSource();
    // resample if needed
    if(decoded.sampleRate !== sampleRate){
      // simple resample: create new buffer and copy (approx)
      const newBuf = offlineCtx.createBuffer(decoded.numberOfChannels, Math.floor(decoded.length * sampleRate / decoded.sampleRate), sampleRate);
      for(let ch=0; ch<decoded.numberOfChannels; ch++){
        const inData = decoded.getChannelData(ch);
        const outData = newBuf.getChannelData(ch);
        // linear resample
        for(let i=0;i<outData.length;i++){
          const t = i * (decoded.length-1) / (outData.length-1);
          const i1 = Math.floor(t);
          const i2 = Math.min(i1+1, inData.length-1);
          const frac = t - i1;
          outData[i] = inData[i1] * (1-frac) + inData[i2] * frac;
        }
      }
      src.buffer = newBuf;
    } else {
      src.buffer = decoded;
    }

    // highpass to remove low hum
    const hp = offlineCtx.createBiquadFilter();
    hp.type = 'highpass';
    hp.frequency.value = 180;

    // lowpass to cut extreme hiss
    const lp = offlineCtx.createBiquadFilter();
    lp.type = 'lowpass';
    lp.frequency.value = 9000;

    // gentle peaking EQ to add presence
    const peq = offlineCtx.createBiquadFilter();
    peq.type = 'peaking';
    peq.frequency.value = 2500;
    peq.gain.value = 3;
    peq.Q.value = 1;

    // dynamics compressor to control levels (acts slightly as noise gate)
    const comp = offlineCtx.createDynamicsCompressor();
    comp.threshold.value = -40;
    comp.knee.value = 20;
    comp.ratio.value = 6;
    comp.attack.value = 0.003;
    comp.release.value = 0.25;

    // gain normalization
    const gain = offlineCtx.createGain();
    gain.gain.value = 1.5;

    // connect chain: src -> hp -> lp -> peq -> comp -> gain -> destination
    src.connect(hp);
    hp.connect(lp);
    lp.connect(peq);
    peq.connect(comp);
    comp.connect(gain);
    gain.connect(offlineCtx.destination);

    src.start(0);
    // render
    const rendered = await offlineCtx.startRendering();

    // normalize loudness (simple peak normalize)
    for(let ch=0; ch<rendered.numberOfChannels; ch++){
      const data = rendered.getChannelData(ch);
      let peak = 0;
      for(let i=0;i<data.length;i++) peak = Math.max(peak, Math.abs(data[i]));
      if(peak > 0){
        const norm = 0.95 / peak;
        for(let i=0;i<data.length;i++) data[i] *= norm;
      }
    }

    // convert AudioBuffer to WAV Blob
    const wav = audioBufferToWav(rendered);
    return new Blob([wav], { type: 'audio/wav' });
  }

  /* ---------- helper: AudioBuffer -> WAV (Float32 -> 16bit PCM) ---------- */
  function audioBufferToWav(buffer){
    const numChannels = buffer.numberOfChannels;
    const sampleRate = buffer.sampleRate;
    const format = 1; // PCM
    const bitDepth = 16;
    const length = buffer.length * numChannels * (bitDepth/8);
    const bufferArray = new ArrayBuffer(44 + length);
    const view = new DataView(bufferArray);
    /* RIFF identifier */
    writeString(view, 0, 'RIFF');
    view.setUint32(4, 36 + length, true);
    writeString(view, 8, 'WAVE');
    /* fmt chunk */
    writeString(view, 12, 'fmt ');
    view.setUint32(16, 16, true);
    view.setUint16(20, format, true);
    view.setUint16(22, numChannels, true);
    view.setUint32(24, sampleRate, true);
    view.setUint32(28, sampleRate * numChannels * (bitDepth/8), true);
    view.setUint16(32, numChannels * (bitDepth/8), true);
    view.setUint16(34, bitDepth, true);
    /* data chunk */
    writeString(view, 36, 'data');
    view.setUint32(40, length, true);

    // write interleaved PCM samples
    let offset = 44;
    const channelData = [];
    for(let ch=0; ch<numChannels; ch++) channelData.push(buffer.getChannelData(ch));
    const sampleCount = buffer.length;
    for(let i=0;i<sampleCount;i++){
      for(let ch=0; ch<numChannels; ch++){
        let sample = Math.max(-1, Math.min(1, channelData[ch][i]));
        view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
        offset += 2;
      }
    }
    return view;
  }
  function writeString(view, offset, string){
    for(let i=0;i<string.length;i++){
      view.setUint8(offset + i, string.charCodeAt(i));
    }
  }

  // resize canvas for hi-DPI
  function resizeCanvas(){
    waveCanvas.width = waveCanvas.clientWidth * devicePixelRatio;
    waveCanvas.height = waveCanvas.clientHeight * devicePixelRatio;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

})();
</script>
<!-- END ADDY Voice Enhance --><!-- ADDY Final Polish Booster Pack -->
<!-- ‚úÖ Meta & SEO polish -->
<meta name="title" content="ADDY.AI ‚Äî Smart Free AI Tools Hub">
<meta name="description" content="Use free AI-powered tools for voice enhancement, image effects, text summary and more. 100% browser-based and secure.">
<meta property="og:title" content="ADDY.AI ‚Äî Free Smart Tools">
<meta property="og:description" content="Premium free AI tools ‚Äî built for everyone. Try now.">
<meta name="theme-color" content="#00e6ff">

<style>
  html{scroll-behavior:smooth;}
  [data-animate]{opacity:0;transform:translateY(30px);transition:all 0.8s ease;}
  [data-animate].visible{opacity:1;transform:translateY(0);}
  .glow-hover:hover{box-shadow:0 0 15px #00f6ff66, inset 0 0 10px #00f6ff33;transform:scale(1.03);}
  #visitorBox{color:#9fe7ff;font-size:13px;text-align:right;margin:10px 0;}
  #contactBox{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);border-radius:10px;padding:10px;margin-top:20px;}
  #contactBox a{color:#00e6ff;text-decoration:none;font-weight:500;}
  footer{margin-top:20px;text-align:center;font-size:13px;color:#8dcde8;}
</style>

<!-- ‚úÖ Visitor Counter -->
<div id="visitorBox">üëÅ Visitors loading...</div>

<!-- ‚úÖ Contact / About section -->
<div id="contactBox" data-animate>
  <h3>üì© Contact</h3>
  <p>Want to collaborate or buy this project?<br>
  <strong>Email:</strong> <a href="mailto:addy.ai.contact@gmail.com">addy.ai.contact@gmail.com</a></p>
  <p style="font-size:12px;color:#7ca9bd">Your messages are welcome ‚Äî suggestions, feedback, or purchase interest.</p>
</div>

<footer data-animate>¬© 2025 <strong>ADDY.AI</strong> ‚Äî Smart Free AI Tools Hub</footer>

<script>
/* Fade-in on scroll animation */
const observer = new IntersectionObserver(entries=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){entry.target.classList.add('visible');}
  });
});
document.querySelectorAll('[data-animate]').forEach(el=>observer.observe(el));

/* Live Visitor Counter (localStorage based mock) */
(function(){
  const box=document.getElementById('visitorBox');
  let count=localStorage.getItem('addy_visitors');
  if(!count){count=Math.floor(Math.random()*50)+10;}
  else{count=parseInt(count)+1;}
  localStorage.setItem('addy_visitors',count);
  box.innerText="üëÅ Total Visitors: "+count;
})();

/* Neon hover effect for all buttons */
document.querySelectorAll('button').forEach(btn=>{
  btn.classList.add('glow-hover');
});
</script>
<!-- END Polish Booster Pack -->
