<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ADDY ‚Äî Super Free AI Hub (Part-1)</title>
  <meta name="description" content="ADDY Part-1: Photo Editor, Voice Reader, Text Tools, Drawing Canvas. Client-side, no API keys.">
  <style>
    :root{
      --bg:#041021; --card:#072033; --accent:#00d4ff; --accent2:#4ce6a1; --muted:#9fb7d8;
      --glass: rgba(255,255,255,0.03);
      --maxw:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#03111b 0%, #02101a 100%);color:#e6f7ff;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--accent)}
    .wrap{max-width:var(--maxw);margin:14px auto;padding:12px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    header h1{margin:0;font-size:20px;color:var(--accent)}
    header .sub{color:var(--muted);font-size:13px}
    nav.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    nav .tab{padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.02);cursor:pointer;color:var(--muted)}
    nav .tab.active{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#012827;font-weight:700}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);margin-top:12px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:14px;margin-top:12px}
    @media(max-width:980px){.grid{grid-template-columns:1fr} .side{order:2}}
    .small{font-size:13px;color:var(--muted)}
    label{font-size:13px;color:#cfe9ff;margin-bottom:6px;display:block}
    input,select,button,textarea{font-family:inherit}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:var(--accent);border:none;color:#022429;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
    .btn.alt{background:#183043;color:#fff}
    canvas{display:block;max-width:100%;border-radius:8px;background:#000;margin-top:10px;border:1px solid rgba(255,255,255,0.03)}
    textarea{width:100%;min-height:90px;border-radius:8px;background:transparent;color:#eaf7ff;border:1px solid rgba(255,255,255,0.04);padding:8px}
    .muted{color:var(--muted);font-size:13px}
    .hint{font-size:12px;color:var(--muted)}
    footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
    .control{margin-top:8px}
    .flex{display:flex;gap:8px;align-items:center}
    .col{display:flex;flex-direction:column;gap:8px}
    .kbd{background:var(--glass);padding:5px 8px;border-radius:6px;color:var(--muted);font-size:13px}
    .progress{height:8px;background:rgba(255,255,255,0.03);border-radius:6px;overflow:hidden;margin-top:6px}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,#00d4ff,#4ce6a1);width:0%}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#00d4ff,#4ce6a1);display:flex;align-items:center;justify-content:center;font-weight:800;color:#012827}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex;gap:12px;align-items:center;">
        <div class="logo">AD</div>
        <div>
          <h1>ADDY ‚Äî Super Free AI Hub (Part-1)</h1>
          <div class="sub">Photo Editor ‚Ä¢ Voice Reader ‚Ä¢ Text Tools ‚Ä¢ Drawing Canvas ‚Äî No API keys</div>
        </div>
      </div>
      <div class="muted">Use Chrome on mobile for best compatibility</div>
    </header>

    <nav class="tabs" id="tabs">
      <div class="tab active" data-tab="editor">Image Editor</div>
      <div class="tab" data-tab="voice">Voice Reader</div>
      <div class="tab" data-tab="text">Text Tools</div>
      <div class="tab" data-tab="draw">Drawing</div>
      <div class="tab" data-tab="help">Help</div>
    </nav>

    <div id="content">
      <!-- EDITOR -->
      <div class="card" id="editor" style="display:block">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">üñºÔ∏è Photo Editor</h2>
            <div class="small">Upload, filter, crop, auto-enhance, download ‚Äî client-side only.</div>
          </div>
          <div class="hint">Tip: Use fit & auto-enhance for better OCR later</div>
        </div>
        <hr/>
        <div class="row">
          <div style="flex:1">
            <label>Upload image</label>
            <input id="fileEditor" type="file" accept="image/*">
            <div class="control row" style="margin-top:8px">
              <button id="fitCanvas" class="btn alt">Fit</button>
              <button id="resetImg" class="btn alt">Reset</button>
              <button id="downloadImg" class="btn">Download PNG</button>
            </div>
          </div>
          <div style="width:320px">
            <label>Quick Presets</label>
            <div class="row">
              <button class="btn" id="preset-natural">Natural</button>
              <button class="btn alt" id="preset-vivid">Vivid</button>
              <button class="btn" id="preset-bw">B/W</button>
            </div>
            <div class="hint" style="margin-top:8px">Use presets to quickly test looks.</div>
          </div>
        </div>

        <canvas id="editorCanvas"></canvas>

        <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:10px">
          <div style="min-width:160px">
            <label>Brightness</label>
            <input id="ed-bright" type="range" min="0" max="200" value="100">
          </div>
          <div style="min-width:160px">
            <label>Contrast</label>
            <input id="ed-contrast" type="range" min="0" max="200" value="100">
          </div>
          <div style="min-width:140px">
            <label>Saturate</label>
            <input id="ed-sat" type="range" min="0" max="200" value="100">
          </div>
          <div style="min-width:140px">
            <label>Blur</label>
            <input id="ed-blur" type="range" min="0" max="12" value="0">
          </div>
          <div style="min-width:120px">
            <label>Hue</label>
            <input id="ed-hue" type="range" min="0" max="360" value="0">
          </div>
          <div style="min-width:120px">
            <label>Tint</label>
            <input id="ed-tint" type="color" value="#ffffff">
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
          <button id="applyEd" class="btn">Apply Filters</button>
          <button id="autoEnhanceBtn" class="btn alt">Auto Enhance</button>
          <button id="cropBtn" class="btn alt">Crop</button>
          <div style="flex:1"></div>
          <div class="muted">Current image: <span id="imgInfo">none</span></div>
        </div>
      </div>

      <!-- VOICE -->
      <div class="card" id="voice" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">üîä Voice Reader (Text ‚Üí Speech)</h2>
            <div class="small">Use browser speechSynthesis to read text aloud. Works offline.</div>
          </div>
          <div class="hint">Choose language/voice and press Read</div>
        </div>
        <hr/>
        <label>Paste text to read</label>
        <textarea id="voiceText" placeholder="Type or paste text..."></textarea>

        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <label style="display:flex;align-items:center;gap:8px">Voice<select id="voiceSelect"></select></label>
          <label style="display:flex;align-items:center;gap:8px">Rate <input id="rate" type="range" min="0.5" max="2" step="0.1" value="1"></label>
          <label style="display:flex;align-items:center;gap:8px">Pitch <input id="pitch" type="range" min="0.5" max="2" step="0.1" value="1"></label>
          <button id="readBtn" class="btn">Read</button>
          <button id="stopRead" class="btn alt">Stop</button>
        </div>

        <div class="hint" style="margin-top:8px">Tip: Use short paragraphs for best results on mobile.</div>
      </div>

      <!-- TEXT -->
      <div class="card" id="text" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">‚úÇÔ∏è Text Tools</h2>
            <div class="small">Summarize, Paraphrase, Copy, Auto-save.</div>
          </div>
          <div class="hint">Autosaves to localStorage</div>
        </div>
        <hr/>
        <label>Input / Paste article</label>
        <textarea id="textInput" placeholder="Paste long text here..."></textarea>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="summBtn" class="btn">Summarize (3 sentences)</button>
          <button id="paraBtn" class="btn alt">Paraphrase (simple)</button>
          <button id="copyText" class="btn">Copy Output</button>
          <button id="clearText" class="btn alt">Clear</button>
        </div>

        <label style="margin-top:8px">Output</label>
        <textarea id="textOutput" placeholder="Output will appear here..."></textarea>
        <div class="hint" style="margin-top:6px">Press Summarize to get extractive summary (client-side)</div>
      </div>

      <!-- DRAW -->
      <div class="card" id="draw" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">üé® Drawing Canvas</h2>
            <div class="small">Draw, stickers, export PNG ‚Äî client-only.</div>
          </div>
          <div class="hint">Use finger (mobile) to draw</div>
        </div>
        <hr/>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <label>Canvas Size <select id="drawSize"><option value="800">800x600</option><option value="600">600x450</option><option value="400">400x300</option></select></label>
          <label>Brush <input id="brushSize" type="range" min="1" max="60" value="6"></label>
          <label>Color <input id="brushColor" type="color" value="#ffffff"></label>
          <button id="clearCanvas" class="btn alt">Clear</button>
          <button id="undoBtn" class="btn alt">Undo</button>
          <button id="saveDraw" class="btn">Export PNG</button>
        </div>
        <canvas id="drawCanvas" style="margin-top:10px;border:1px solid rgba(255,255,255,0.04);border-radius:8px"></canvas>
        <div class="hint" style="margin-top:8px">You can drag images onto the canvas (desktop) or use sticker paste.</div>
      </div>

      <!-- HELP -->
      <div class="card" id="help" style="display:none">
        <h2 style="margin:0">‚ÑπÔ∏è Help & Next Steps</h2>
        <hr/>
        <div class="small">
          <ul>
            <li>Part-1 provides client-side tools only ‚Äî no API keys.</li>
            <li>Part-2 will add: BodyPix background remove, OCR export improvements, embed list of free HF spaces.</li>
            <li>Part-3 will add: QR, GrabCut, style transfer hooks, session manager & deploy pack generator.</li>
            <li>To make this production-ready (monetize), later we'll add serverless proxies and user auth (optional).</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="card">
        <h3 style="margin:0">Quick Actions</h3>
        <hr/>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="clearAllBtn" class="btn alt">Clear All</button>
          <button id="exportSession" class="btn">Export Session</button>
          <button id="importSession" class="btn alt">Import Session</button>
          <input type="file" id="importFile" accept=".json" style="display:none">
        </div>
        <label style="margin-top:10px">Session Notes</label>
        <textarea id="sessionNotes" placeholder="Notes..."></textarea>
      </div>

      <aside class="side card">
        <h3 style="margin:0">Tips</h3>
        <hr/>
        <div class="small">
          ‚Ä¢ Use Fit before removing background in future parts.<br>
          ‚Ä¢ Use Auto-enhance for OCR clarity.<br>
          ‚Ä¢ Save sessions to continue later.<br>
          ‚Ä¢ For voice, choose appropriate voice in dropdown.<br>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="nextPart" class="btn">Request Part-2</button>
          <button id="askDeploy" class="btn alt">Make GitHub Pack</button>
        </div>
      </aside>
    </div>

    <footer>Made with ‚ù§Ô∏è ‚Äî ADDY Part-1 ‚Äî paste into index.html and commit. Reply "next" to get Part-2.</footer>
  </div>

<script>
/* -----------------------
   ADDY Part-1 JS
   - Editor, Voice Reader, Text Tools, Drawing canvas
   - Client-side only; no external API keys
   ----------------------- */

/* Utilities */
const $ = id => document.getElementById(id);
const qs = s => document.querySelector(s);
function showTab(name){
  ['editor','voice','text','draw','help'].forEach(t=>{
    const el = $(t); if(el) el.style.display = (t===name? 'block':'none');
    // tabs
    document.querySelectorAll('#tabs .tab').forEach(tab=>{
      tab.classList.toggle('active', tab.dataset.tab===name);
    });
  });
}

/* Tab nav */
document.querySelectorAll('#tabs .tab').forEach(tab=>{
  tab.addEventListener('click', ()=> showTab(tab.dataset.tab));
});

/* ------------------ Photo Editor ------------------ */
const fileEditor = $('fileEditor'), editorCanvas = $('editorCanvas'), ectx = editorCanvas.getContext('2d');
let edImg = new Image(), edOriginal = null, edCurrentData = null;

function fitEditorCanvas(maxW=900){
  const w = Math.min(window.innerWidth-40, maxW);
  if(!edImg.src) return;
  const ratio = edImg.naturalHeight / edImg.naturalWidth;
  editorCanvas.width = w;
  editorCanvas.height = Math.round(w * ratio);
  drawEditor();
}

fileEditor.addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ev=>{
    edImg = new Image();
    edImg.onload = ()=> { edOriginal = ev.target.result; fitEditorCanvas(); $('imgInfo').innerText = edImg.naturalWidth + 'x' + edImg.naturalHeight; };
    edImg.src = ev.target.result;
  };
  reader.readAsDataURL(f);
});

window.addEventListener('resize', ()=> fitEditorCanvas());

function drawEditor(){
  if(!edImg.src) return;
  ectx.clearRect(0,0,editorCanvas.width,editorCanvas.height);
  const b = $('ed-bright').value, c = $('ed-contrast').value, s = $('ed-sat').value, bl = $('ed-blur').value, hue = $('ed-hue').value;
  const filter = `brightness(${b}%) contrast(${c}%) saturate(${s}%) blur(${bl}px) hue-rotate(${hue}deg)`;
  ectx.filter = filter;
  ectx.drawImage(edImg, 0,0, editorCanvas.width, editorCanvas.height);
  ectx.filter = 'none';
  const tint = $('ed-tint').value;
  if(tint && tint !== '#ffffff'){
    ectx.fillStyle = tint + '33';
    ectx.fillRect(0,0,editorCanvas.width,editorCanvas.height);
  }
  try{ edCurrentData = editorCanvas.toDataURL('image/png'); }catch(e){ console.log('ed toDataURL failed', e); }
}

['ed-bright','ed-contrast','ed-sat','ed-blur','ed-hue'].forEach(id=> $(id).addEventListener('input', drawEditor));
$('ed-tint').addEventListener('input', drawEditor);

$('fitCanvas').addEventListener('click', ()=> fitEditorCanvas());
$('resetImg').addEventListener('click', ()=> { if(edOriginal){ edImg.src = edOriginal; fitEditorCanvas(); }});
$('downloadImg').addEventListener('click', ()=> {
  if(!edCurrentData && edOriginal) { edImg.src = edOriginal; fitEditorCanvas(); }
  if(!edCurrentData) return alert('Upload image first');
  const a = document.createElement('a'); a.href = edCurrentData; a.download = 'addy_edit.png'; a.click();
});

/* presets */
$('preset-natural').addEventListener('click', ()=>{
  $('ed-bright').value=100; $('ed-contrast').value=100; $('ed-sat').value=100; $('ed-blur').value=0; $('ed-hue').value=0; $('ed-tint').value='#ffffff'; drawEditor();
});
$('preset-vivid').addEventListener('click', ()=>{
  $('ed-bright').value=110; $('ed-contrast').value=120; $('ed-sat').value=140; $('ed-blur').value=0; $('ed-hue').value=0; $('ed-tint').value='#ffffff'; drawEditor();
});
$('preset-bw').addEventListener('click', ()=>{ $('ed-sat').value=0; $('ed-contrast').value=110; $('ed-bright').value=95; $('ed-tint').value='#ffffff'; drawEditor();});

/* auto-enhance */
$('autoEnhanceBtn').addEventListener('click', ()=>{
  if(!edImg.src) return alert('Upload an image first');
  // simple histogram stretch on a temp canvas
  const tmp = document.createElement('canvas'); tmp.width = edImg.naturalWidth; tmp.height = edImg.naturalHeight;
  const tctx = tmp.getContext('2d'); tctx.drawImage(edImg,0,0);
  const imgd = tctx.getImageData(0,0,tmp.width,tmp.height);
  let rmin=255,gmin=255,bmin=255, rmax=0,gmax=0,bmax=0;
  for(let i=0;i<imgd.data.length;i+=4){
    const r=imgd.data[i], g=imgd.data[i+1], b=imgd.data[i+2];
    if(r<rmin) rmin=r; if(g<gmin) gmin=g; if(b<bmin) bmin=b;
    if(r>rmax) rmax=r; if(g>gmax) gmax=g; if(b>bmax) bmax=b;
  }
  for(let i=0;i<imgd.data.length;i+=4){
    imgd.data[i] = Math.round((imgd.data[i]-rmin)/(rmax-rmin||1)*255);
    imgd.data[i+1] = Math.round((imgd.data[i+1]-gmin)/(gmax-gmin||1)*255);
    imgd.data[i+2] = Math.round((imgd.data[i+2]-bmin)/(bmax-bmin||1)*255);
  }
  tctx.putImageData(imgd,0,0);
  edImg.src = tmp.toDataURL();
  edOriginal = edImg.src;
  fitEditorCanvas();
});

/* crop - simple center crop to square example */
$('cropBtn').addEventListener('click', ()=>{
  if(!edImg.src) return alert('Upload an image first');
  const tmp = document.createElement('canvas'); const min = Math.min(edImg.naturalWidth, edImg.naturalHeight);
  tmp.width = min; tmp.height = min;
  const tctx = tmp.getContext('2d');
  tctx.drawImage(edImg, (edImg.naturalWidth-min)/2, (edImg.naturalHeight-min)/2, min, min, 0,0,min,min);
  edImg.src = tmp.toDataURL();
  edOriginal = edImg.src;
  fitEditorCanvas();
});

/* ------------------ Voice Reader ------------------ */
const synth = window.speechSynthesis;
let voices = [];
function populateVoices(){
  voices = synth.getVoices();
  const sel = $('voiceSelect'); sel.innerHTML = '';
  voices.forEach(v=>{
    const opt = document.createElement('option'); opt.value = v.name; opt.textContent = `${v.name} (${v.lang})`;
    sel.appendChild(opt);
  });
}
if(synth.onvoiceschanged !== undefined) synth.onvoiceschanged = populateVoices;
populateVoices();

$('readBtn').addEventListener('click', ()=>{
  const text = $('voiceText').value || '';
  if(!text) return alert('Type some text first');
  if(synth.speaking) { synth.cancel(); }
  const ut = new SpeechSynthesisUtterance(text);
  const sel = $('voiceSelect').value;
  if(sel){
    const v = voices.find(x=>x.name===sel);
    if(v) ut.voice = v;
  }
  ut.rate = parseFloat($('rate').value);
  ut.pitch = parseFloat($('pitch').value);
  synth.speak(ut);
});
$('stopRead').addEventListener('click', ()=> synth.cancel());

/* ------------------ Text Tools ------------------ */
function simpleSummarize(text, maxSent=3){
  if(!text) return '';
  const sents = text.match(/[^\.!\?]+[\.!\?]+/g) || [text];
  const freq = {}; const stop = new Set(['the','is','and','a','an','of','to','in','that','it','for','on','with','as','are','was','be','by','this','i','you']);
  sents.forEach(sent=>{
    sent.toLowerCase().replace(/[^a-z0-9\s]/g,'').split(/\s+/).forEach(w=>{
      if(!w) return; if(stop.has(w)) return; freq[w] = (freq[w]||0)+1;
    });
  });
  const scores = sents.map(sent=>{
    let sc=0; sent.toLowerCase().replace(/[^a-z0-9\s]/g,'').split(/\s+/).forEach(w=>{ if(freq[w]) sc += freq[w]; }); return sc;
  });
  const idx = scores.map((v,i)=>[v,i]).sort((a,b)=>b[0]-a[0]).slice(0,maxSent).sort((a,b)=>a[1]-b[1]);
  return idx.map(x=>sents[x[1]].trim()).join(' ');
}
$('summBtn').addEventListener('click', ()=> {
  const t = $('textInput').value; $('textOutput').value = simpleSummarize(t,3);
});
$('paraBtn').addEventListener('click', ()=> {
  const t = $('textInput').value; if(!t) return alert('Paste text first');
  const map = {'important':'crucial','use':'utilize','help':'assist','buy':'purchase','get':'obtain','said':'stated','really':'truly','very':'extremely'};
  const out = t.replace(/\b(\w+)\b/g, (m)=> map[m.toLowerCase()] || m);
  $('textOutput').value = out;
});
$('copyText').addEventListener('click', ()=> navigator.clipboard.writeText($('textOutput').value).then(()=>alert('Copied')));
$('clearText').addEventListener('click', ()=> { $('textInput').value=''; $('textOutput').value=''; localStorage.removeItem('addy_text'); });

/* autosave text */
setInterval(()=> {
  const v = $('textInput').value || '';
  if(v && v.length>20) localStorage.setItem('addy_text', v);
}, 5000);
/* restore */
window.addEventListener('load', ()=> {
  const saved = localStorage.getItem('addy_text'); if(saved) $('textInput').value = saved;
});

/* ------------------ Drawing Canvas ------------------ */
const drawCanvas = $('drawCanvas'), dctx = drawCanvas.getContext('2d');
let drawState = { size: parseInt($('brushSize').value), color: $('brushColor').value, drawing:false, paths:[], undone:[] };

function initDrawCanvas(){
  const sz = parseInt($('drawSize').value);
  drawCanvas.width = sz; drawCanvas.height = Math.round(sz * 0.75);
  // clear
  dctx.fillStyle = '#021018'; dctx.fillRect(0,0,drawCanvas.width,drawCanvas.height);
  drawState.paths = []; drawState.undone = [];
}
initDrawCanvas();

function startDraw(x,y){ drawState.drawing = true; const p = {tool:'pen', color: drawState.color, size: drawState.size, points:[{x,y}]}; drawState.paths.push(p); }
function continueDraw(x,y){ if(!drawState.drawing) return; const p = drawState.paths[drawState.paths.length-1]; p.points.push({x,y}); redrawPaths(); }
function endDraw(){ drawState.drawing = false; }

function redrawPaths(){
  dctx.clearRect(0,0,drawCanvas.width,drawCanvas.height);
  dctx.fillStyle = '#021018'; dctx.fillRect(0,0,drawCanvas.width,drawCanvas.height);
  for(const stroke of drawState.paths){
    dctx.strokeStyle = stroke.color; dctx.lineWidth = stroke.size; dctx.lineJoin = 'round'; dctx.lineCap='round';
    dctx.beginPath();
    const pts = stroke.points;
    if(pts.length>0){ dctx.moveTo(pts[0].x, pts[0].y); for(let i=1;i<pts.length;i++){ dctx.lineTo(pts[i].x, pts[i].y); } dctx.stroke(); }
  }
}

drawCanvas.addEventListener('pointerdown', (e)=> {
  const rect = drawCanvas.getBoundingClientRect(); startDraw(e.clientX-rect.left, e.clientY-rect.top);
});
drawCanvas.addEventListener('pointermove', (e)=> {
  if(!drawState.drawing) return; const rect = drawCanvas.getBoundingClientRect(); continueDraw(e.clientX-rect.left, e.clientY-rect.top);
});
window.addEventListener('pointerup', ()=> endDraw());

$('brushSize').addEventListener('input', ()=> drawState.size = parseInt($('brushSize').value));
$('brushColor').addEventListener('input', ()=> drawState.color = $('brushColor').value);
$('drawSize').addEventListener('change', ()=> initDrawCanvas());
$('clearCanvas').addEventListener('click', ()=> { initDrawCanvas(); });
$('undoBtn').addEventListener('click', ()=> { if(drawState.paths.length) drawState.undone.push(drawState.paths.pop()); redrawPaths(); });
$('saveDraw').addEventListener('click', ()=> {
  const a = document.createElement('a'); a.href = drawCanvas.toDataURL('image/png'); a.download = 'addy_draw.png'; a.click();
});

/* ------------------ Session export/import & quick actions ------------------ */
$('clearAllBtn').addEventListener('click', ()=> {
  // clear editor, draw, text and voice
  edImg = new Image(); edOriginal = null; edCurrentData = null; try{ ectx.clearRect(0,0,editorCanvas.width,editorCanvas.height);}catch(e){}
  initDrawCanvas(); $('textInput').value=''; $('textOutput').value=''; $('voiceText').value=''; $('ocrResult') && ($('ocrResult').value='');
  alert('Cleared all (client only)');
});
$('exportSession').addEventListener('click', ()=> {
  const sess = { editor: edCurrentData || edOriginal, text: $('textInput').value, notes: $('sessionNotes').value, draw: drawCanvas.toDataURL() };
  const blob = new Blob([JSON.stringify(sess,null,2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'addy_session.json'; a.click();
});
$('importSession').addEventListener('click', ()=> $('importFile').click());
$('importFile').addEventListener('change', (e)=> {
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader(); reader.onload = ev=>{
    try{
      const data = JSON.parse(ev.target.result);
      if(data.editor){ edImg = new Image(); edImg.onload = ()=> { edOriginal = data.editor; fitEditorCanvas(); }; edImg.src = data.editor; }
      if(data.draw){ const img = new Image(); img.onload = ()=> { dctx.clearRect(0,0,drawCanvas.width,drawCanvas.height); dctx.drawImage(img,0,0); }; img.src = data.draw; }
      $('textInput').value = data.text || ''; $('sessionNotes').value = data.notes || '';
      alert('Session imported');
    }catch(err){ alert('Import error: '+err.message); }
  }; reader.readAsText(f);
});

/* ------------------ Simple OCR placeholder (will add in Part-2 full Tesseract UI) ------------------ */
const ocrEl = $('ocrResult');
if(ocrEl) ocrEl.value = '';

/* ------------------ Request next part / deploy pack ------------------ */
$('nextPart').addEventListener('click', ()=> alert('I will prepare Part-2 (BodyPix, OCR improvements, embed list). Reply "next" if you want it now.'));
$('askDeploy').addEventListener('click', ()=> alert('I will prepare a GitHub-ready zip pack (index.html) for one-click upload. Reply "deploy" to request it.'));

window.addEventListener('load', ()=> {
  // set a tiny timeout to ensure voices populated
  setTimeout(()=> { if(speechSynthesis.getVoices().length) populateVoices(); }, 500);
  initDrawCanvas();
});

</script>
</body>
</html><!-- ADDY Part-2 (1/4): Enhance + Background Remove -->
<script>
/* ----------- 8K-style Image Enhancer (client-side pseudo upscaler) ----------- */
function enhanceImage(canvas){
  const ctx = canvas.getContext('2d');
  let imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
  let d = imgData.data;

  // simple unsharp mask
  let blur = ctx.getImageData(0,0,canvas.width,canvas.height);
  const k=[1,2,1,2,4,2,1,2,1];
  for(let y=1;y<canvas.height-1;y++){
    for(let x=1;x<canvas.width-1;x++){
      for(let c=0;c<3;c++){
        let sum=0,idx=0;
        for(let ky=-1;ky<=1;ky++){
          for(let kx=-1;kx<=1;kx++){
            const i=((y+ky)*canvas.width+(x+kx))*4+c;
            sum+=blur.data[i]*k[idx++];
          }
        }
        const i2=(y*canvas.width+x)*4+c;
        const val=d[i2]+(d[i2]-sum/16)*0.5; // sharpen
        d[i2]=Math.min(255,Math.max(0,val));
      }
    }
  }
  // contrast stretch
  let rMin=255,rMax=0,gMin=255,gMax=0,bMin=255,bMax=0;
  for(let i=0;i<d.length;i+=4){
    const r=d[i],g=d[i+1],b=d[i+2];
    if(r<rMin)rMin=r;if(r>rMax)rMax=r;
    if(g<gMin)gMin=g;if(g>gMax)gMax=g;
    if(b<bMin)bMin=b;if(b>bMax)bMax=b;
  }
  for(let i=0;i<d.length;i+=4){
    d[i]=(d[i]-rMin)/(rMax-rMin||1)*255;
    d[i+1]=(d[i+1]-gMin)/(gMax-gMin||1)*255;
    d[i+2]=(d[i+2]-bMin)/(bMax-bMin||1)*255;
  }
  ctx.putImageData(imgData,0,0);
  alert("Enhanced (pseudo-8K look)");
}
const enhanceBtn = document.createElement('button');
enhanceBtn.textContent="Ultra Enhance (8K-style)";
enhanceBtn.className="btn";
enhanceBtn.onclick=()=> enhanceImage(editorCanvas);
$('applyEd').after(enhanceBtn);

/* ----------- Background Remove (BodyPix lite) ----------- */
async function loadBodyPix(){
  if(window.bodyPixLoaded) return window.bodyPixNet;
  const script=document.createElement('script');
  script.src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js";
  document.body.appendChild(script);
  await new Promise(r=>script.onload=r);
  const script2=document.createElement('script');
  script2.src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.2.0";
  document.body.appendChild(script2);
  await new Promise(r=>script2.onload=r);
  window.bodyPixLoaded=true;
  window.bodyPixNet=await bodyPix.load();
  return window.bodyPixNet;
}

async function removeBg(){
  if(!edImg.src) return alert('Upload an image first');
  const net = await loadBodyPix();
  const tmp=document.createElement('canvas');
  tmp.width=edImg.naturalWidth; tmp.height=edImg.naturalHeight;
  const ctx2=tmp.getContext('2d');
  ctx2.drawImage(edImg,0,0);
  const segmentation=await net.segmentPerson(tmp);
  const imageData=ctx2.getImageData(0,0,tmp.width,tmp.height);
  for(let i=0;i<segmentation.data.length;i++){
    if(segmentation.data[i]===0) imageData.data[i*4+3]=0;
  }
  ctx2.putImageData(imageData,0,0);
  edImg.src=tmp.toDataURL();
  edOriginal=edImg.src;
  fitEditorCanvas();
  alert("Background removed (BodyPix)");
}
const bgBtn=document.createElement('button');
bgBtn.textContent="Remove BG (Lite)";
bgBtn.className="btn alt";
bgBtn.onclick=removeBg;
$('applyEd').after(bgBtn);
</script>
<!-- END Part-2 (1/4) -->
